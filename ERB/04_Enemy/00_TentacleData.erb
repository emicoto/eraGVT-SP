;--------------------------------------------------
;ボス触手・ラスボス触手の殲滅状況確認
;ローカル変数LOCAL:0はチェック用
;LOCAL:1は生き残っている触手の総数が入る
@TENTACLE_SURVIVE, ARGS
LOCAL:0 = 1
LOCAL:1 = 0
LOCAL:2 = 0
LOCAL:3 = 0

IF FLAG:10 == 0 || FLAG:10 == 2
	LOCAL:4 = 0
ELSE
	LOCAL:4 = 1
ENDIF

IF LOCAL:4 == 0
	FOR LOCAL:2, 0, FLAG:3
		CALL TENTACLE_SURVIVE_CHECK, LOCAL:0
		IF RESULT > 0
			SELECTCASE ARGS
				CASE "NAME"
					CALL TENTACLE_ACCESS, "NAME"
				CASE "NUM"
					LOCAL:1 += 1
			ENDSELECT
		ENDIF
		LOCAL:0 *= 2
	NEXT

	;返す値の選定
	SELECTCASE ARGS
		CASE "NUM"
			RETURN LOCAL:1
	ENDSELECT
ELSEIF LOCAL:4 == 1
	FOR LOCAL:2, 0, FLAG:4
		CALL TENTACLE_SURVIVE_CHECK, LOCAL:0
		IF RESULT > 0
			SELECTCASE ARGS
				CASE "NAME"
					CALL TENTACLE_ACCESS, "NAME"
				CASE "NUM"
					LOCAL:1 += 1
			ENDSELECT
		ENDIF
		LOCAL:0 *= 2
	NEXT

	;返す値の選定
	SELECTCASE ARGS
		CASE "NUM"
			RETURN LOCAL:1
	ENDSELECT
ENDIF

;--------------------------------------------------
;ビット値を投げて生きているボス触手・ラスボス触手の番号を返す
;BOSSx.ERBの番号を返す
@TENTACLE_SURVIVE_CHECK, ARG
IF FLAG:10 == 0 || FLAG:10 == 2
	LOCAL:4 = 0
ELSE
	LOCAL:4 = 1
ENDIF

IF LOCAL:4 == 0
	IF FLAG:100 & ARG
		;C触手
		IF ARG == 1
			RETURN 1
		;V触手
		ELSEIF ARG == 2
			RETURN 2
		;A触手
		ELSEIF ARG == 4
			RETURN 3
		;B触手
		ELSEIF ARG == 8
			RETURN 4
		;S触手
		ELSEIF ARG == 16
			RETURN 5
		;P触手
		ELSEIF ARG == 32
			RETURN 6
		;H触手
		ELSEIF ARG == 64
			RETURN 7
		;０か負の値
		ELSEIF ARG <= 0
			PRINTL 
			PRINTL #####     ERROR !!     #####
			PRINTL @TENTACLE_SURVIVE_CHECKにて
			PRINTFORML 参照しようとしているボスIDが０か負の値（ARG = {ARG}）になっています。原因究明のため、
			PRINTL 掲示板にできるだけ詳細な発生状況を報告してください
			PRINTW 
		ELSE
			PRINTL 
			PRINTL #####     ERROR !!     #####
			PRINTL @TENTACLE_SURVIVE_CHECKにて
			PRINTFORML 参照しようとしているボスIDが範囲外（ARG = {ARG}）になっています。原因究明のため、
			PRINTL 掲示板にできるだけ詳細な発生状況を報告してください
			PRINTW 
		ENDIF
	ENDIF
ELSEIF LOCAL:4 == 1
	IF FLAG:101 & ARG
		;K触手
		IF ARG == 1
			RETURN 1
		;天使の樹
		ELSEIF ARG == 2
			RETURN 2
		;０か負の値
		ELSEIF ARG <= 0
			PRINTL 
			PRINTL #####     ERROR !!     #####
			PRINTL @TENTACLE_SURVIVE_CHECKにて
			PRINTFORML 参照しようとしているラスボスIDが０か負の値（ARG = {ARG}）になっています。原因究明のため、
			PRINTL 掲示板にできるだけ詳細な発生状況を報告してください
			PRINTW 
		ELSE
			PRINTL 
			PRINTL #####     ERROR !!     #####
			PRINTL @TENTACLE_SURVIVE_CHECKにて
			PRINTFORML 参照しようとしているラスボスIDが範囲外（ARG = {ARG}）になっています。原因究明のため、
			PRINTL 掲示板にできるだけ詳細な発生状況を報告してください
			PRINTW 
		ENDIF
	ENDIF
ENDIF

;--------------------------------------------------
;BOSSx.ERBの番号を元にボス触手・ラスボス触手のビット値を返す
;上の関数の逆版
@TENTACLE_BITVALUE, ARG
IF FLAG:10 == 0 || FLAG:10 == 2
	LOCAL:4 = 0
ELSE
	LOCAL:4 = 1
ENDIF

IF LOCAL:4 == 0
	;C触手
	IF ARG == 1
		RETURN 1
	;V触手
	ELSEIF ARG == 2
		RETURN 2
	;A触手
	ELSEIF ARG == 3
		RETURN 4
	;B触手
	ELSEIF ARG == 4
		RETURN 8
	;S触手
	ELSEIF ARG == 5
		RETURN 16
	;P触手
	ELSEIF ARG == 6
		RETURN 32
	;H触手
	ELSEIF ARG == 7
		RETURN 64
	;０か負の値
	ELSEIF ARG <= 0
		PRINTL 
		PRINTL #####     ERROR !!     #####
		PRINTL @TENTACLE_BITVALUEにて
		PRINTFORML 参照しようとしているボスIDが０か負の値（ARG = {ARG}）になっています。原因究明のため、
		PRINTL 掲示板にできるだけ詳細な発生状況を報告してください
		PRINTW 
	ELSE
		PRINTL 
		PRINTL #####     ERROR !!     #####
		PRINTL @TENTACLE_BITVALUEにて
		PRINTFORML 参照しようとしているボスIDが範囲外（ARG = {ARG}）になっています。原因究明のため、
		PRINTL 掲示板にできるだけ詳細な発生状況を報告してください
		PRINTW 
	ENDIF
ELSEIF LOCAL:4 == 1
	;K触手
	IF ARG == 1
		RETURN 1
	;天使の樹
	ELSEIF ARG == 2
		RETURN 2
	;０か負の値
	ELSEIF ARG <= 0
		PRINTL 
		PRINTL #####     ERROR !!     #####
		PRINTL @TENTACLE_BITVALUEにて
		PRINTFORML 参照しようとしているラスボスIDが０か負の値（ARG = {ARG}）になっています。原因究明のため、
		PRINTL 掲示板にできるだけ詳細な発生状況を報告してください
		PRINTW 
	ELSE
		PRINTL 
		PRINTL #####     ERROR !!     #####
		PRINTL @TENTACLE_BITVALUEにて
		PRINTFORML 参照しようとしているラスボスIDが範囲外（ARG = {ARG}）になっています。原因究明のため、
		PRINTL 掲示板にできるだけ詳細な発生状況を報告してください
		PRINTW 
	ENDIF
ENDIF

;--------------------------------------------------
;触手のファイルにアクセス（戦闘用）
;FLAG:10の値でアクセス先がボス触手かラスボス触手か判定する
;パッチ1 幼体とか雑魚触手生成用　置換BOSS→%SAVESTR:13%
@TENTACLE_ACCESS, ARGS
IF FLAG:10 == 0 || FLAG:10 == 2
	LOCAL:4 = 0
ELSE
	LOCAL:4 = 1
ENDIF

IF LOCAL:4 == 0
	SELECTCASE ARGS
		CASE "NAME"
			CALL TENTACLE_ACCESS, "GETNAME"
			PRINTFORM %RESULTS%
		CASE "GETNAME"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_GETNAME
		CASE "HP"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_HP
			RETURN RESULT
		CASE "SYASEI"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_SYASEI
			RETURN RESULT
		CASE "SAKUSEI"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_SAKUSEI
			RETURN RESULT
		CASE "YUDAN"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_YUDAN
			RETURN RESULT
		CASE "KOUGEKI"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_KOUGEKI
			RETURN RESULT
		CASE "BOUGYO"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_BOUGYO
			RETURN RESULT
		CASE "BINSYOU"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_BINSYOU
			RETURN RESULT
		CASE "CHISEI"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_CHISEI
			RETURN RESULT
		CASE "SHORT"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_SHORT
			RETURN RESULT
		CASE "MIDDLE"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_MIDDLE
			RETURN RESULT
		CASE "LONG"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_LONG
			RETURN RESULT
		CASE "HOLD"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_HOLD
			RETURN RESULT
		CASE "ATTACK_ROUTINE"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_ATTACK_ROUTINE
			RETURN RESULT
		CASE "SEX_ROUTINE"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_SEX_ROUTINE
			RETURN RESULT
		CASE "PALAM_HOSEI"
			TRYCALLFORM TENTACLE_%SAVESTR:13%_{FLAG:11}_PALAM_HOSEI
			RETURN RESULT:0, RESULT:1, RESULT:2, RESULT:3, RESULT:4, RESULT:5, RESULT:6, RESULT:7, RESULT:8, RESULT:9, RESULT:10, RESULT:11
	ENDSELECT
ELSEIF LOCAL:4 == 1
	SELECTCASE ARGS
		CASE "NAME"
			CALL TENTACLE_ACCESS, "GETNAME"
			PRINTFORM %RESULTS%
		CASE "GETNAME"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_GETNAME
		CASE "HP"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_HP
			RETURN RESULT
		CASE "SYASEI"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_SYASEI
			RETURN RESULT
		CASE "SAKUSEI"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_SAKUSEI
			RETURN RESULT
		CASE "YUDAN"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_YUDAN
			RETURN RESULT
		CASE "KOUGEKI"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_KOUGEKI
			RETURN RESULT
		CASE "BOUGYO"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_BOUGYO
			RETURN RESULT
		CASE "BINSYOU"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_BINSYOU
			RETURN RESULT
		CASE "CHISEI"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_CHISEI
			RETURN RESULT
		CASE "SHORT"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_SHORT
			RETURN RESULT
		CASE "MIDDLE"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_MIDDLE
			RETURN RESULT
		CASE "LONG"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_LONG
			RETURN RESULT
		CASE "HOLD"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_HOLD
			RETURN RESULT
		CASE "ATTACK_ROUTINE"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_ATTACK_ROUTINE
			RETURN RESULT
		CASE "SEX_ROUTINE"
			TRYCALLFORM TENTACLE_LASTBOSS_{FLAG:11}_SEX_ROUTINE
			RETURN RESULT
		CASE "PALAM_HOSEI"
			TRYCALLFORM TENTACLE_BOSS_{FLAG:11}_PALAM_HOSEI
			RETURN RESULT:0, RESULT:1, RESULT:2, RESULT:3, RESULT:4, RESULT:5, RESULT:6, RESULT:7, RESULT:8, RESULT:9, RESULT:10, RESULT:11
	ENDSELECT
ENDIF

;--------------------------------------------------
;触手のファイルにアクセス（幽閉用）
;CFLAG:20の値でアクセス先がボス触手かラスボス触手か判定する
@TENTACLE_ACCESS_PRISON, ARG, ARGS
IF CFLAG:ARG:20 == 0
	SELECTCASE ARGS
		CASE "NAME"
			CALL TENTACLE_ACCESS_PRISON, ARG, "GETNAME"
			PRINTFORM %RESULTS%
		CASE "GETNAME"
			TRYCALLFORM TENTACLE_BOSS_{CFLAG:ARG:21}_GETNAME
		CASE "PRISON_ROUTINE"
			TRYCALLFORM TENTACLE_BOSS_{CFLAG:ARG:21}_PRISON_ROUTINE
			RETURN RESULT
		CASE "PALAM_HOSEI"
			TRYCALLFORM TENTACLE_BOSS_{CFLAG:ARG:21}_PALAM_HOSEI
			RETURN RESULT:0, RESULT:1, RESULT:2, RESULT:3, RESULT:4, RESULT:5, RESULT:6, RESULT:7, RESULT:8, RESULT:9, RESULT:10, RESULT:11
	ENDSELECT
ELSEIF CFLAG:ARG:20 == 1
	SELECTCASE ARGS
		CASE "NAME"
			CALL TENTACLE_ACCESS_PRISON, ARG, "GETNAME"
			PRINTFORM %RESULTS%
		CASE "GETNAME"
			TRYCALLFORM TENTACLE_LASTBOSS_{CFLAG:ARG:21}_GETNAME
		CASE "PRISON_ROUTINE"
			TRYCALLFORM TENTACLE_LASTBOSS_{CFLAG:ARG:21}_PRISON_ROUTINE
			RETURN RESULT
		CASE "PALAM_HOSEI"
			TRYCALLFORM TENTACLE_BOSS_{CFLAG:ARG:21}_PALAM_HOSEI
			RETURN RESULT:0, RESULT:1, RESULT:2, RESULT:3, RESULT:4, RESULT:5, RESULT:6, RESULT:7, RESULT:8, RESULT:9, RESULT:10, RESULT:11
	ENDSELECT
ENDIF

;--------------------------------------------------
;ボス触手・ラスボス触手の補正
;式 ((Lv * 10 + 95) * BASE) /100 + BONUS
@TENTACLE_STATUS_HOSEI, ARG,ARG:1 = 100
CALL TENTACLE_LEVEL
LOCAL:0 = RESULT * 10
LOCAL:2 = ((LOCAL:0 + 95) * ARG) / 100 + ARG:1
RETURN LOCAL:2

;--------------------------------------------------
;ボス触手・ラスボス触手のレベル
@TENTACLE_LEVEL
CALL TENTACLE_SURVIVE, "NUM"
LOCAL:0 = FLAG:3 - RESULT
;撃破した触手の数に応じてレベル上昇
IF FLAG:0 == 4
	LOCAL:4 = 5
ELSEIF FLAG:0 == 2
	LOCAL:4 = 4
ELSEIF FLAG:0 == 10
	LOCAL:4 = 2
ELSE
	LOCAL:4 = 3
ENDIF
LOCAL:1 = LOCAL:0 * LOCAL:4 + 4
SIF FLAG:10 == 2
	LOCAL:1 = LOCAL:1 * 3 / 4

;日数経過による補正をかける
IF FLAG:0 == 10
	LOCAL:2 = 50 * DAY / FLAG:2 / 100
ELSEIF FLAG:0 == 4
	LOCAL:2 = 200 * DAY / FLAG:2 / 100
ELSE
	LOCAL:2 = 150 * DAY / FLAG:2 / 100
ENDIF

;計算結果
LOCAL:3 = LOCAL:1 + LOCAL:2
RETURN LOCAL:3
