@SAVEGAME_PAGE
#DIM SLOT_LIMIT

;Clear Last Page
CLEARLINE LINECOUNT - FIRSTLINE
REDRAW 0
FIRSTLINE = LINECOUNT

;Print Page Lavel
SETCOLOR COLOR_GRAY
DRAWLINE
PRINTFORM %INDENT(2)%
SETCOLOR COLOR_ORANGE
PRINTFORM ★ 記憶の廻廊
RESETCOLOR


PRINTFORM %INDENT(8)%
PRINTFORM どの部屋に記憶を保管しますか？
PRINTL
SETCOLOR COLOR_DARK
DRAWLINEFORM -
RESETCOLOR

; セーブモードで表示
CALL PRINT_SAVEDATA(1)
REDRAW 1

SAVENOS SLOT_LIMIT
INPUT

; 戻る

IF RESULT == 999
CLEARLINE LINECOUNT - FIRSTLINE
	RETURN
	
; 前のページへ
ELSEIF RESULT == 101
	CALL MOVE_SAVEDATA(GLOBAL:300 - 10)
	GOTO RELOAD

; 次のページへ
ELSEIF RESULT == 102
	CALL MOVE_SAVEDATA(GLOBAL:300 + 10)
	GOTO RELOAD

ELSEIF RESULT == 98 || RESULT == 99
PRINTW オートセーブの枠にセーブすることができません。 
	GOTO RELOAD
; 入力不可の数字
ELSEIF RESULT < 0 || RESULT >= SLOT_LIMIT
	GOTO RELOAD
ELSE
	LOCAL = RESULT
	CHKDATA LOCAL
	;RESULT == 1は"ファイルが存在しない"
	IF RESULT != 1
		PRINTL 既にデータが存在します。上書きしますか？
		PRINTL [0] はい
		PRINTL [1] いいえ
        $INPUT_LOOP
		INPUT
		IF RESULT == 1
			GOTO RELOAD
		ELSEIF RESULT != 0
			GOTO INPUT_LOOP
		ENDIF
	ENDIF
	CALL SAVEINFO_SP
	SAVEDATA LOCAL, RESULTS
ENDIF

$RELOAD
CLEARLINE LINECOUNT - FIRSTLINE
RESTART


@LOADGAME_PAGE
#DIM SLOT_LIMIT

;Clear Last Page
CLEARLINE LINECOUNT - FIRSTLINE
REDRAW 0
FIRSTLINE = LINECOUNT

;Print Page Lavel
SETCOLOR COLOR_GRAY
DRAWLINE
PRINTFORM %INDENT(2)%
SETCOLOR COLOR_ORANGE
PRINTFORM ★ 記憶の廻廊
RESETCOLOR

PRINTFORM %INDENT(8)%
PRINTFORM どの記憶を思い出しますか？
PRINTL
SETCOLOR COLOR_DARK
DRAWLINEFORM -
RESETCOLOR

; ロードモードで表示
CALL PRINT_SAVEDATA
REDRAW 1

SAVENOS SLOT_LIMIT
INPUT
; 戻る
IF RESULT == 999
CLEARLINE LINECOUNT - FIRSTLINE
	RETURN
	
; 前のページへ
ELSEIF RESULT == 101
	CALL MOVE_SAVEDATA(GLOBAL:300 - 10)
	GOTO RELOAD

; 次のページへ
ELSEIF RESULT == 102
	CALL MOVE_SAVEDATA(GLOBAL:300 + 10)
	GOTO RELOAD
	
; 入力不可の数字
ELSEIF (RESULT < 0 || RESULT >= SLOT_LIMIT) && (RESULT != 98 && RESULT != 99)
	GOTO RELOAD
	
ELSE
	LOCAL = RESULT
	CHKDATA LOCAL
	;RESULT == 0ならロード可能
	IF RESULT != 0
		GOTO RELOAD
	ENDIF
	LOADDATA LOCAL
ENDIF

$RELOAD
CLEARLINE LINECOUNT - FIRSTLINE
RESTART

@PRINT_SAVEDATA(MODE = 0)
#DIM	MODE	; 0:LOAD 1:SAVE
#DIM	LCOUNT

	; セーブデータを表示
	; セーブデータの表示はデザインを優先した為、結構な力業です
	FOR LCOUNT, GLOBAL:300, (GLOBAL:300 + 5)
		; セーブデータのコメント読み込み & 分割
		; 前周のゴミを引き継がないよう毎回初期化

		; 左表示 SLOT NUM と時間
		VARSET SAVE_ARRAY
		CHKDATA LCOUNT+1
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVETIME(LCOUNT+1)
		
		; 右表示
		VARSET SAVE_ARRAY
		CHKDATA (LCOUNT + 6)
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVETIME(LCOUNT + 6)
		
		PRINTL 

		; 左情報表示
		VARSET SAVE_ARRAY
		CHKDATA LCOUNT+1
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEINFO_1(LCOUNT+1)
		
		; 右情報表示
		VARSET SAVE_ARRAY
		CHKDATA (LCOUNT + 6)
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEINFO_1(LCOUNT + 6)
		
		PRINTL 

		; 左状況表示
		VARSET SAVE_ARRAY
		CHKDATA LCOUNT+1
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEINFO_2(LCOUNT+1)
		
		; 右状況表示
		VARSET SAVE_ARRAY
		CHKDATA (LCOUNT + 6)
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEINFO_2(LCOUNT + 6)
		
		PRINTL 
		
		; 左モード表示
		VARSET SAVE_ARRAY
		CHKDATA LCOUNT+1
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEMODE(LCOUNT+1)
		
		; 右モード表示
		VARSET SAVE_ARRAY
		CHKDATA (LCOUNT + 6)
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEMODE(LCOUNT + 6)

		PRINTL 
		PRINTL
	NEXT


	; オートセーブの表示
		SETCOLOR COLOR_ORANGE
		ALIGNMENT CENTER
		PRINT ★ AutoSave ★ 
		RESETCOLOR
		PRINTL
		ALIGNMENT LEFT
		; 左時間表示
		VARSET SAVE_ARRAY
		CHKDATA 98
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVETIME(98)
		
		; 右時間表示
		VARSET SAVE_ARRAY
		CHKDATA 99
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVETIME(99)
		
		PRINTL 

		; 左状況表示
		VARSET SAVE_ARRAY
		CHKDATA 98
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEINFO_1(98)
		
		; 右状況表示
		VARSET SAVE_ARRAY
		CHKDATA 99
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEINFO_1(99)
		
		PRINTL 

		; 左状況表示
		VARSET SAVE_ARRAY
		CHKDATA 98
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEINFO_2(98)
		
		; 右状況表示
		VARSET SAVE_ARRAY
		CHKDATA 99
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEINFO_2(99)
		
		PRINTL 

		; 左モード表示
		VARSET SAVE_ARRAY
		CHKDATA 98
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEMODE(98)
		
		; 右モード表示
		VARSET SAVE_ARRAY
		CHKDATA 99
		SPLIT RESULTS:0, ",", SAVE_ARRAY
		CALL SHOW_SAVEMODE(99)
		PRINTL 

	CALL ADD_MAXLINE(35)
	SETCOLOR COLOR_GRAY
	DRAWLINE
	RESETCOLOR
	PRINTFORML %"　[101] 前のページ", 52, LEFT%%"　 　[999] 戻る",20,LEFT%%"[102] 次のページ　", 52, RIGHT%

RETURN

@SYSTEM_AUTOSAVE
;オートセーブの処理を独自に行う場合、@SYSTEM_AUTOSAVEを定義する
;@SYSTEM_AUTOSAVEが定義されていると、標準のオートセーブの代わりにSYSTEM_AUTOSAVEが呼ばれる。
CALL AUTO_SAVE

;独自のオートセーブ処理
@AUTO_SAVE
DUMPRAND
CALL SAVEINFO_SP
SAVEDATA 98 + AUTOSAVE_DOMAIN, RESULTS
AUTOSAVE_DOMAIN += 1
SIF AUTOSAVE_DOMAIN > 1
AUTOSAVE_DOMAIN = 0

; セーブデータの参照ページを変更します
@MOVE_SAVEDATA(ARG)
#DIM SLOT_LIMIT
#DIM LCOUNT

TEMP = 0

	; 変更したページが有効かどうかチェック
	; 0以下 もしくはCONFIGのセーブ数超なら変更失敗
	SAVENOS SLOT_LIMIT
	; 0未満
	IF ARG < 0
		; 最終ページを参照するように
		; 引数の1桁目を丸める
		TEMP = (SLOT_LIMIT - 1) / 10
		TEMP = TEMP * 10
		LCOUNT = TEMP
		
	; CONFIGのセーブ設定数超
	ELSEIF ARG >= SLOT_LIMIT
		; 初期ページを参照するように
		LCOUNT = 0
		
	; 通常処理
	ELSE
		; 指定されたページを参照する
		; 引数の1桁目を丸める
		TEMP = ARG / 10
		TEMP = TEMP * 10
		LCOUNT = TEMP
	ENDIF
	
	; 変更したらGLOBAL書き換え
	LOADGLOBAL
	GLOBAL:300 = LCOUNT
	SAVEGLOBAL
	
RETURN
