


@GENERATE_WEAPON_STRS, ARG
#DIM LCOUNT
#DIM LFLAG
#DIM KEEP_VAR
#DIMS RES_STR, 50
#DIMS KEEP_STR, 10

ARG = LIMIT(ARG, 1, 50)
LFLAG = 6

PRINTL 　　　　　生成文字列　　　　　　　　　　　　　　キープ
DO
	IF LFLAG & 2
		FOR LCOUNT, 0, ARG
			VARSET RESULTS
			IF GETBIT(LFLAG, 2) == 0 && GETBIT(LFLAG, 3) == 0
				IF RAND:2
					CALL GENERATE_WEAPON_STR
				ELSE
					CALL GENERATE_WEAPON_STR_JP
				ENDIF
			ELSEIF GETBIT(LFLAG, 2)
				CALL GENERATE_WEAPON_STR
			ELSE
				CALL GENERATE_WEAPON_STR_JP
			ENDIF
			RES_STR:LCOUNT = %RESULTS%
			SIF RESULTS:1 != ""
				RES_STR:LCOUNT = %RES_STR:LCOUNT% <%RESULTS:1%>
		NEXT
		CLEARBIT LFLAG, 1
	ENDIF

	LFLAG |= 1
	FOR LCOUNT, 0, LIMIT(ARG, 10, 50)

		IF LCOUNT < ARG
			PRINTFORM 　[{LCOUNT, 2}] %RES_STR:LCOUNT, 32, LEFT% 
			PRINTBUTTON "→ ", LCOUNT + 300
		ELSE
			PRINTFORM 　　　 %UNICODE(0x2000) * 32%　 
		ENDIF

		PRINTPLAIN  

		IF LCOUNT < 10
			IF KEEP_STR:LCOUNT == ""
				PRINT [--]　―――　　　　　　
			ELSE
				PRINTFORM [{LCOUNT + 50}] %KEEP_STR:LCOUNT, 32, LEFT% [{LCOUNT + 60}] 削除
			ENDIF
		ELSE
			PRINT 　　　　　　　　　　　　
		ENDIF

		IF LCOUNT == ARG - 3
			PRINTFORM [110]カナ名　　\@GETBIT(LFLAG, 2)?%UNICODE(0x2611)%#%UNICODE(0x2610)%\@
		ENDIF

		IF LCOUNT == ARG - 2
			PRINTFORM [120]和名　　　\@GETBIT(LFLAG, 3)?%UNICODE(0x2611)%#%UNICODE(0x2610)%\@
		ENDIF

		IF LCOUNT == ARG - 1
			PRINTFORM [130]ランダム　\@GETBIT(LFLAG, 2) == 0 && GETBIT(LFLAG, 3) == 0?%UNICODE(0x2611)%#%UNICODE(0x2610)%\@
		ENDIF

		PRINTL 
	NEXT

	PRINTL 
	PRINTL  [100]再生成
	DRAWLINE
	PRINTL  [999]戻る

	INPUT

	IF RESULT == 999
		LFLAG = 0
		RESULTS = 
		LOCAL = 0
	ELSEIF RESULT == 100
		LFLAG |= 2
	ELSEIF RESULT == 110
		SETBIT LFLAG, 2
		CLEARBIT LFLAG, 3
		LFLAG |= 2
	ELSEIF RESULT == 120
		CLEARBIT LFLAG, 2
		SETBIT LFLAG, 3
		LFLAG |= 2
	ELSEIF RESULT == 130
;		LFLAG &= 4
;		LFLAG &= 8
		CLEARBIT LFLAG, 2
		CLEARBIT LFLAG, 3
		LFLAG |= 2
	ELSEIF RESULT >= 0 && RESULT < ARG
		PRINTL 
		PRINTFORML %RES_STR:RESULT%
		PRINTL 　
		WAIT
		RESULTS = %RES_STR:RESULT%
		CLEARLINE 3
		LFLAG = 0
		LOCAL = 1
	ELSEIF RESULT >= 50 && RESULT < 60
		PRINTL 
		PRINTFORML %KEEP_STR:(RESULT - 50)%
		PRINTL 　
		WAIT
		RESULTS = %KEEP_STR:(RESULT - 50)%
		CLEARLINE 3
		LFLAG = 0
		LOCAL = 1
	ELSEIF RESULT >= 300 && RESULT < ARG + 300
		IF KEEP_VAR < 10
			KEEP_STR:KEEP_VAR = %RES_STR:(RESULT - 300)%
			KEEP_VAR += 1
		ELSE
			FOR LCOUNT, 1, 10
				KEEP_STR:(LCOUNT - 1) = %KEEP_STR:LCOUNT%
			NEXT
			KEEP_STR:(KEEP_VAR - 1) = %RES_STR:(RESULT - 300)%
		ENDIF
	ELSEIF RESULT >= 60 && RESULT < KEEP_VAR + 60
		FOR LCOUNT, RESULT % 10 + 1, 10
			KEEP_STR:(LCOUNT - 1) = %KEEP_STR:LCOUNT%
		NEXT
		KEEP_STR:9 = 
		KEEP_VAR -= 1
	ENDIF
	SIF LFLAG != 0
		CLEARLINE LIMIT(ARG, 10, 50) + 5
LOOP LFLAG & 1
RETURN LOCAL

@WEAPON_ADD_STRS, ARG, ARG:1
#DIM INS_VAR, 7
#DIM ENT_VAR
#DIM LFLAG
;ループ変数
#DIM LCOUNT, 2

#DIM RES_VAR, 10
;項目名
#DIMS ENT_STR
;
#DIMS INS_STR
;
#DIMS OR_STR, 2
#DIMS RES_STR, 10
#DIMS PRE_NAME, 3, 3
#DIMS SELF_CL

IF CDFLAG:ARG:(ARG:1):武器名元位置
	SUBSTRING CSTR:ARG:(ARG:1 + 4), CDFLAG:ARG:(ARG:1):武器名元位置 / 100, CDFLAG:ARG:(ARG:1):武器名元位置 % 100
	LOCALS = %RESULTS%
ELSE
	LOCALS = %CSTR:ARG:(ARG:1 + 4)%
ENDIF

VARSET OR_STR
;名前と読みを切り分け
SPLIT LOCALS, " <", OR_STR
SIF OR_STR:1 != ""
	OR_STR:1 = %UNICODE(0x0020)%<%OR_STR:1%
PRINTL 
LFLAG = 1

PRINTFORML 　　武器名：%OR_STR:0%%OR_STR:1%　　　　戦闘スタイル：%FSTYLE_NAME_F(ARG,ARG:1)%
DO
	WHILE LCOUNT:0 < 7 && GETBIT(LFLAG, 0)
		IF GETBIT(LFLAG, 2)
;剣	斬　　　　
			IF INS_VAR:5 == 1
				INS_VAR:6 = 1
;刀	斬　　　　
			ELSEIF INS_VAR:5 == 2
				INS_VAR:6 = 1
;槍	　　突　　
			ELSEIF INS_VAR:5 == 3
				INS_VAR:6 = 4
;斧	斬打　　　
			ELSEIF INS_VAR:5 == 4
				INS_VAR:6 = 3
;槌	　打　　　
			ELSEIF INS_VAR:5 == 5
				INS_VAR:6 = 2
;拳	　打突　　
			ELSEIF INS_VAR:5 == 6
				INS_VAR:6 = 6
;爪	斬打　　　
			ELSEIF INS_VAR:5 == 7
				INS_VAR:6 = 3
;棍	　打　　　
			ELSEIF INS_VAR:5 == 8
				INS_VAR:6 = 2
;杖	　打　　術
			ELSEIF INS_VAR:5 == 9
				INS_VAR:6 = 18
;鎌	斬　　　術
			ELSEIF INS_VAR:5 == 10
				INS_VAR:6 = 17
;鞭	　打　　　
			ELSEIF INS_VAR:5 == 11
				INS_VAR:6 = 2
;鋼糸	斬　　　　
			ELSEIF INS_VAR:5 == 12
				INS_VAR:6 = 1
;鎖鋸	斬　　　　
			ELSEIF INS_VAR:5 == 13
				INS_VAR:6 = 1
;杭槍	　打突　　
			ELSEIF INS_VAR:5 == 14
				INS_VAR:6 = 6
;弓	　　　射　
			ELSEIF INS_VAR:5 == 15
				INS_VAR:6 = 8
;銃	　　　射　
			ELSEIF INS_VAR:5 == 16
				INS_VAR:6 = 8
;砲	　打　射　
			ELSEIF INS_VAR:5 == 17
				INS_VAR:6 = 10
;符	　　　　術
			ELSEIF INS_VAR:5 == 18
				INS_VAR:6 = 16
;珠	　　　　術
			ELSEIF INS_VAR:5 == 19
				INS_VAR:6 = 16
			ELSE
				INS_VAR:6 = 0
			ENDIF
			CLEARBIT LFLAG, 2
		ENDIF
		ENT_STR = 
		IF LCOUNT:0 == 0
			ENT_VAR = 2
			ENT_STR = <<読み>>
		ELSEIF LCOUNT:0 == 1
			ENT_VAR = 3
			ENT_STR = <<追加文字列>>
		ELSEIF LCOUNT:0 == 2
			ENT_VAR = 4
			ENT_STR = <<区切り>>
		ELSEIF LCOUNT:0 == 3
			ENT_VAR = 3
			ENT_STR = <<強調>>
		ELSEIF LCOUNT:0 == 4
			ENT_VAR = 10
			ENT_STR = <<属性>>
		ELSEIF LCOUNT:0 == 5
			ENT_VAR = 21
			ENT_STR = <<武器種>>
		ELSEIF LCOUNT:0 == 6
			ENT_VAR = 5
			ENT_STR = <<攻撃属性>>
		ENDIF
		FOR LCOUNT:1, 0, ENT_VAR
			IF LCOUNT:0 == 0
				IF LCOUNT:1 == 0
					INS_STR = あり
				ELSEIF LCOUNT:1 == 1
					INS_STR = なし
				ENDIF
			ELSEIF LCOUNT:0 == 1
				IF LCOUNT:1 == 0
					INS_STR = なし
				ELSEIF LCOUNT:1 == 1
					INS_STR = 接頭語
				ELSEIF LCOUNT:1 == 2
					INS_STR = 接尾語
				ENDIF
			ELSEIF LCOUNT:0 == 2
				IF LCOUNT:1 == 0
					INS_STR = なし
				ELSEIF LCOUNT:1 == 1
					INS_STR = 半角( )
				ELSEIF LCOUNT:1 == 2
					INS_STR = 全角(　)
				ELSEIF LCOUNT:1 == 3
					INS_STR = 中黒(・)
				ENDIF
			ELSEIF LCOUNT:0 == 3
				IF LCOUNT:1 == 0
					INS_STR = なし
				ELSEIF LCOUNT:1 == 1
					INS_STR = ""
				ELSEIF LCOUNT:1 == 2
					INS_STR = 「」
				ENDIF
			ELSEIF LCOUNT:0 == 4
				IF LCOUNT:1 == 0
					INS_STR = なし
				ELSEIF LCOUNT:1 == 1
					INS_STR = 火
				ELSEIF LCOUNT:1 == 2
					INS_STR = 氷
				ELSEIF LCOUNT:1 == 3
					INS_STR = 雷
				ELSEIF LCOUNT:1 == 4
					INS_STR = 水
				ELSEIF LCOUNT:1 == 5
					INS_STR = 風
				ELSEIF LCOUNT:1 == 6
					INS_STR = 地
				ELSEIF LCOUNT:1 == 7
					INS_STR = 毒
				ELSEIF LCOUNT:1 == 8
					INS_STR = 光
				ELSEIF LCOUNT:1 == 9
					INS_STR = 闇
				ENDIF
			ELSEIF LCOUNT:0 == 5
				IF LCOUNT:1 == 0
					INS_STR = なし
				ELSEIF LCOUNT:1 == 1
					INS_STR = 剣
				ELSEIF LCOUNT:1 == 2
					INS_STR = 刀
				ELSEIF LCOUNT:1 == 3
					INS_STR = 槍
				ELSEIF LCOUNT:1 == 4
					INS_STR = 斧
				ELSEIF LCOUNT:1 == 5
					INS_STR = 槌
				ELSEIF LCOUNT:1 == 6
					INS_STR = 拳
				ELSEIF LCOUNT:1 == 7
					INS_STR = 爪
				ELSEIF LCOUNT:1 == 8
					INS_STR = 棍
				ELSEIF LCOUNT:1 == 9
					INS_STR = 杖
				ELSEIF LCOUNT:1 == 10
					INS_STR = 鎌
				ELSEIF LCOUNT:1 == 11
					INS_STR = 鞭
				ELSEIF LCOUNT:1 == 12
					INS_STR = 鋼糸
				ELSEIF LCOUNT:1 == 13
					INS_STR = 鎖鋸
				ELSEIF LCOUNT:1 == 14
					INS_STR = 杭槍
				ELSEIF LCOUNT:1 == 15
					INS_STR = 弓
				ELSEIF LCOUNT:1 == 16
					INS_STR = 銃
				ELSEIF LCOUNT:1 == 17
					INS_STR = 砲
				ELSEIF LCOUNT:1 == 18
					INS_STR = 符
				ELSEIF LCOUNT:1 == 19
					INS_STR = 珠
				ELSEIF LCOUNT:1 == 20
					INS_STR = 自由入力
				ENDIF
			ELSEIF LCOUNT:0 == 6
				IF LCOUNT:1 == 0
					INS_STR = 斬
				ELSEIF LCOUNT:1 == 1
					INS_STR = 打
				ELSEIF LCOUNT:1 == 2
					INS_STR = 突
				ELSEIF LCOUNT:1 == 3
					INS_STR = 射
				ELSEIF LCOUNT:1 == 4
					INS_STR = 術
				ENDIF
			ENDIF

			IF LCOUNT:1 % 4 == 0
				PRINTL 
				PRINTFORM %ENT_STR, 14, LEFT%
				PRINTPLAIN 　
				ENT_STR = 
			ENDIF
			SIF INS_VAR:(LCOUNT:0) == LCOUNT:1 && LCOUNT:0 != 6
				SETCOLOR 128, 255, 128

			SIF GETBIT(INS_VAR:6, LCOUNT:1) && LCOUNT:0 == 6
				SETCOLOR 128, 255, 128

			;読みがない
			SIF LCOUNT:0 == 0 && OR_STR:1 == ""
				SETCOLOR 128, 128, 128
			;接頭語以外
			SIF INS_VAR:1 != 1 && (LCOUNT:0 == 2 || LCOUNT:0 == 3)
				SETCOLOR 128, 128, 128
			;追加文字列なし
			SIF INS_VAR:1 == 0 && (LCOUNT:0 == 4 || LCOUNT:0 == 5 || LCOUNT:0 == 6)
				SETCOLOR 128, 128, 128

			PRINTFORM [{LCOUNT:0 * 10 + (LCOUNT:0 == 6) * 20 + LCOUNT:1, 2}]%INS_STR, 8, LEFT%
			IF LCOUNT:0 != 6
				PRINTFORM \@INS_VAR:(LCOUNT:0) == LCOUNT:1 ? %UNICODE(0x2611)% # %UNICODE(0x2610)%\@
			ELSE
				PRINTFORM \@GETBIT(INS_VAR:(LCOUNT:0), LCOUNT:1) ? %UNICODE(0x2611)% # %UNICODE(0x2610)%\@
			ENDIF

			SIF LCOUNT:0 == 5 && LCOUNT:1 == 20
				PRINTFORM \@SELF_CL == "" ?  # （%SELF_CL%）\@
			RESETCOLOR
			PRINTPLAIN 　 　
		NEXT
		LCOUNT:0 += 1
		PRINTL 
	WEND
	LCOUNT:0 = 0
	IF GETBIT(LFLAG, 0)
		PRINTL 
		PRINTL 　　　　　　　　　　　　　　　　　　　　　　　　　　　[100]生成　　　　　[200]リセット　
		DRAWLINE
		PRINTL  [999]戻る
		INPUT
		IF RESULT < 0
		ELSEIF RESULT == 70
			INS_VAR:5 = 20
			PRINTL 武器の種類を入力してください（１〜２文字程度のものにすることを推奨します）
			INPUTS
			SELF_CL = %RESULTS%
			SIF SELF_CL == ""
				INS_VAR:5 = 0
			CLEARLINE 1
		ELSEIF RESULT < 60
			INS_VAR:(RESULT / 10) = RESULT % 10
		ELSEIF RESULT < 70
			INS_VAR:5 = RESULT - 50
		ELSEIF RESULT >= 80 && RESULT < 85
			INVERTBIT INS_VAR:6, RESULT - 80
		ELSEIF RESULT == 100
			LFLAG = 2
		ELSEIF RESULT == 200
			VARSET INS_VAR
		ELSEIF RESULT == 999
			LFLAG = 0
		ELSE
			
		ENDIF
		SIF RESULT >= 50 && RESULT <= 70
			SETBIT LFLAG, 2
		SIF GETBIT(LFLAG, 0)
			CLEARLINE 27
	ENDIF

	WHILE LCOUNT:0 < 10 && GETBIT(LFLAG, 1)
		IF INS_VAR:2 == 0
			LOCALS:1 = 
		ELSEIF INS_VAR:2 == 1
			LOCALS:1 =  %UNICODE(0x0020)%
		ELSEIF INS_VAR:2 == 2
			LOCALS:1 = 　
		ELSEIF INS_VAR:2 == 3
			LOCALS:1 = ・
		ENDIF

		IF INS_VAR:3 == 0
			LOCALS:2 = 
			LOCALS:3 = 
		ELSEIF INS_VAR:3 == 1
			LOCALS:2 = "
			LOCALS:3 = "
		ELSEIF INS_VAR:3 == 2
			LOCALS:2 = 「
			LOCALS:3 = 」
		ENDIF

		CALL GENERATE_ADD_STR, CDFLAG:(ARG):(ARG:1):戦闘スタイル, INS_VAR:1, INS_VAR:4, INS_VAR:5, INS_VAR:6, SELF_CL
		IF INS_VAR:1 == 0
			LOCALS:0 = 
			LOCALS:4 = 
		ELSEIF INS_VAR:1 == 1
			LOCALS:0 = %RESULTS%
			LOCALS:4 = 
		ELSEIF INS_VAR:1 == 2
			LOCALS:0 = 
			LOCALS:1 = 
			LOCALS:2 = 
			LOCALS:3 = 
			LOCALS:4 = の%RESULTS%
		ENDIF

		LOCALS:5 = %LOCALS:0%%LOCALS:1%%LOCALS:2%
		LOCALS:6 = %OR_STR:0%\@INS_VAR:0 == 0 ? %OR_STR:1% # \@
		LOCALS:7 = %LOCALS:3%%LOCALS:4%

		STRLENS LOCALS:5
		LOCAL:0 = RESULT
		STRLENS LOCALS:6
		LOCAL:1 = RESULT
		STRLENS LOCALS:7
		LOCAL:2 = RESULT
		RES_VAR:(LCOUNT:0) = LOCAL:0 * 100 + LOCAL:1

		RES_STR:(LCOUNT:0) = %LOCALS:5%%LOCALS:6%%LOCALS:7%

		PRINTFORML 　 [{LCOUNT:0 + 110}] %RES_STR:(LCOUNT:0)%
		LCOUNT:0 += 1
	WEND

	IF GETBIT(LFLAG, 1)
		PRINTL 
		PRINTL  [100]再生成　　[200]設定変更
		DRAWLINE
		PRINTL  [999]戻る
		LCOUNT:0 = 0
		INPUT
		IF RESULT == 200
			LFLAG = 1
;15+27
			CLEARLINE 42
		ELSEIF RESULT >= 110 && RESULT < 120
			RESULTS = %RES_STR:(RESULT - 110)%
			RETURN RES_VAR:(RESULT - 110)
			LFLAG = 0
		ELSEIF RESULT == 999
			LFLAG = 0
		ELSE
			CLEARLINE 15
		ENDIF
	ENDIF

LOOP LFLAG
