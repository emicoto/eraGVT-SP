;**********************************************************
;周回のデータ引き継ぎに関する処理
@SUCCESSION,ARG
#DIM NOWLINECOUNT
#DIM POINTS
#DIM USED
#DIM HAVE_DAUGHTER
#DIM NOWPAGE
#DIM PAGEMAX
#DIM LCOUNT
#DIM CCOUNT, 3
POINTS = 0
USED = 0
HAVE_DAUGHTER = 0
NOWPAGE = 1
PAGEMAX = 2
FLAG:64 = 0
VARSET LOCAL
FOR CCOUNT, 0, CHARANUM
	SIF CCOUNT == MASTER
		CONTINUE
	;娘が居るかを判定
	SIF CFLAG:CCOUNT:231
		HAVE_DAUGHTER ++
	;変身状態を解く
	SIF CFLAG:CCOUNT:1 > 0
		CALL TRANSFORM, 0, CCOUNT
NEXT
PRINTW …
PRINTW ……
PRINTW ………
CALL LB
PRINTL +-+-+☆★☆　周回ポイントの獲得　☆★☆+-+-+
CALL SHORTLINE
PRINTFORML 周回数累計(引き継ぎ回数)　　　　　　　　　+{FLAG:854 - 1}
POINTS += FLAG:854 - 1
IF FLAG:0 == 2
	PRINTFORML ソロクリア　　　　　　　　　　　　　　　　+2
	POINTS += 2
ELSEIF FLAG:0 == 1
	PRINTFORML ノーマルクリア　　　　　　　　　　　　　　+5
	POINTS += 5
ELSEIF FLAG:0 == 4
	PRINTFORML ハードコアクリア　　　　　　　　　　　　　+7
	POINTS += 7
ENDIF
IF ARG == 6
	PRINTFORML 総合Ｓランク　　　　　　　　　　　　　　　+8
	POINTS += 8
ELSEIF ARG == 5
	PRINTFORML 総合Ａランク　　　　　　　　　　　　　　　+5
	POINTS += 5
ELSEIF ARG == 4
	PRINTFORML 総合Ｂランク　　　　　　　　　　　　　　　+3
	POINTS += 3
ELSEIF ARG == 3
	PRINTFORML 総合Ｃランク　　　　　　　　　　　　　　　+2
	POINTS += 2
ELSEIF ARG == 2
	PRINTFORML 総合Ｄランク　　　　　　　　　　　　　　　+1
	POINTS += 1
ELSEIF ARG == 1
	PRINTFORML 総合Ｅランク　　　　　　　　　　　　　　　+0
ENDIF
;覇者の証
IF GLOBAL:111
	PRINTFORML 覇者の証　　　　　　　　　　　　　　　　　+5
	POINTS += 5
ENDIF
;へっぽこ大魔王
IF GLOBAL:112
	PRINTFORML へっぽこ大魔王　　　　　　　　　　　　　　+5
	POINTS += 5
ENDIF
;eraGVTマスター
IF GLOBAL:113
	PRINTFORML eraGVTマスター　　　　　　　　　　　　　　+5
	POINTS += 5
ENDIF
;ENDLESSボス撃破数
IF GLOBAL:114 >= 8
	IF GLOBAL:114 >= 60
		LOCAL = 12
	ELSEIF GLOBAL:114 >= 50
		LOCAL = 8
	ELSEIF GLOBAL:114 >= 40
		LOCAL = 6
	ELSEIF GLOBAL:114 >= 30
		LOCAL = 4
	ELSEIF GLOBAL:114 >= 20
		LOCAL = 2
	ELSE
		LOCAL = 1
	ENDIF
	PRINTFORML ENDLESS撃破数ボーナス 　　　　　　　　　　+{LOCAL}
	POINTS += LOCAL
ENDIF
LOCAL = 0
;腕力自慢
SIF GLOBAL:120
	LOCAL += 1
;脳筋こそ至高
SIF GLOBAL:121
	LOCAL += 1
;メイン盾きた！
SIF GLOBAL:122
	LOCAL += 1
;移動城塞
SIF GLOBAL:123
	LOCAL += 1
;韋駄天
SIF GLOBAL:124
	LOCAL += 1
;俊足瞬撃、並ぶものなし
SIF GLOBAL:125
	LOCAL += 1
;データにはなかったぞ！？
SIF GLOBAL:126
	LOCAL += 1
;静かなる賢者
SIF GLOBAL:127
	LOCAL += 1
;不死身のソルジャー
SIF GLOBAL:128
	LOCAL += 2
;ライオンハート
SIF GLOBAL:129
	LOCAL += 2
;絶倫魔法少女
SIF GLOBAL:130
	LOCAL += 2
;グランドマスター
SIF GLOBAL:131
	LOCAL += 1
;主砲オーケストラ
SIF GLOBAL:132
	LOCAL += 1
;スナイパードライツェン
SIF GLOBAL:133
	LOCAL += 1
;性の目覚め
SIF GLOBAL:140
	LOCAL += 1
;触れられただけで・・・
SIF GLOBAL:141
	LOCAL += 1
;艶やかなる饗宴
SIF GLOBAL:142
	LOCAL += 1
;淫界の住人
SIF GLOBAL:143
	LOCAL += 2
;双なる具現
SIF GLOBAL:144
	LOCAL += 2
;キャトルガール
SIF GLOBAL:145
	LOCAL += 2
;初めての出産
SIF GLOBAL:150
	LOCAL += 1
;駆け出しママン
SIF GLOBAL:151
	LOCAL += 1
;暗黒ベビーブーム
SIF GLOBAL:152
	LOCAL += 1
;THE QUEEN
SIF GLOBAL:153
	LOCAL += 2
;幸せ家族計画
SIF GLOBAL:154
	LOCAL += 1
;寄生ジョーカー
SIF GLOBAL:155
	LOCAL += 1
;マジ☆かるアイドル育成計画
SIF GLOBAL:156
	LOCAL += 1
;ＡＶ女優
SIF GLOBAL:157
	LOCAL += 1
;捕らわれのお姫様
SIF GLOBAL:158
	LOCAL += 1
;もったいないお化け
SIF GLOBAL:159
	LOCAL += 1
;触手なんかに負けない！
SIF GLOBAL:160
	LOCAL += 1
;不屈の闘志
SIF GLOBAL:161
	LOCAL += 1
;淫鬱ハネムーン
SIF GLOBAL:162
	LOCAL += 2
;破壊神の一撃
SIF GLOBAL:163
	LOCAL += 1
;処女アナル愛好家
SIF GLOBAL:164
	LOCAL += 1
;NEXT GENERATION
SIF GLOBAL:165
	LOCAL += 1
;パーフェクトキル
SIF GLOBAL:166
	LOCAL += 2
;奇跡の逆転勝利
SIF GLOBAL:167
	LOCAL += 1
;タクティカルオーダー
SIF GLOBAL:168
	LOCAL += 1
;バトルレイヤー
SIF GLOBAL:169
	LOCAL += 1
;とびっきりの最強対最強
SIF GLOBAL:170
	LOCAL += 2
PRINTFORML 実績による周回ボーナス　　　　　　　　　　+{LOCAL}
POINTS += LOCAL
CALL SHORTLINE
PRINTFORML 合計　　　　　　　　　　　　　　　　　　　{POINTS}pts.
PRINTL 
PRINTW [PRESS ENTER]
CLEARLINE 1
;----------------------------------------------------------------------------------------------------------------------------------
;引き継ぎ選択の処理開始
FOR LOCAL,21,31
	LOCAL:LOCAL = FLAG:(880+LOCAL)
NEXT
REDRAW 0
VARSET LOCAL
$MASTER_LOOP
NOWLINECOUNT = LINECOUNT
PRINTFORML データ引き継ぎ　　　　　　　　　　 　　　　　　のこり周回ポイント ({POINTS - USED}pts.)
DRAWLINE
PRINTFORML 入手した周回ポイントを消費して次の周回にデータを引き継ぐことができます。
PRINTFORML 名前や種族など、ゲーム開始時にキャラが持っていたデータは自動で引き継がれます。
PRINTFORML 引き継ぐ項目を選んでください。
PRINTL 
IF NOWPAGE == 1
	PRINTFORML  [0] 引き継ぎキャラ選択　　　　　　　　現在 {LOCAL:10}人
	PRINTL 
	IF LOCAL:11
		PRINTL  [1] 性成長引き継ぎ　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 4
			SETCOLOR 96,96,96
		PRINTL  [1] 性成長引き継ぎ　　　　　　　　　　-4
		RESETCOLOR
	ENDIF
	IF LOCAL:12
		PRINTL  [2] 娘引き継ぎ　　　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 15 || HAVE_DAUGHTER == 0
			SETCOLOR 96,96,96
		PRINTL  [2] 娘引き継ぎ　　　　　　　　　　　　-15
		RESETCOLOR
	ENDIF
	IF GLOBAL:113
		IF LOCAL:13
			PRINTL  [3] レベル引き継ぎ　　　　　　　　　　(選択済み)
		ELSE
			SIF POINTS < 30
				SETCOLOR 96,96,96
			PRINTL  [3] レベル引き継ぎ　　　　　　　　　　-30
			RESETCOLOR
		ENDIF
	ELSE
		SETCOLOR 96,96,96
		PRINTL  [3] ？？？
		RESETCOLOR
	ENDIF
	IF LOCAL:14
		PRINTL  [4] 戦技引き継ぎ　　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 8
			SETCOLOR 96,96,96
		PRINTL  [4] 戦技引き継ぎ　　　　　　　　　　　-8
		RESETCOLOR
	ENDIF
	IF LOCAL:15 == 1
		PRINTL  [5] 資金引き継ぎ　　　　　　　　　　　25％
	ELSEIF LOCAL:15 == 2
		PRINTL  [5] 資金引き継ぎ　　　　　　　　　　　50％
	ELSEIF LOCAL:15 == 3
		PRINTL  [5] 資金引き継ぎ　　　　　　　　　　　75％
	ELSEIF LOCAL:15 == 4
		PRINTL  [5] 資金引き継ぎ　　　　　　　　　　　100％
	ELSE
		PRINTL  [5] 資金引き継ぎ　　　　　　　　　　　なし
	ENDIF
	IF LOCAL:16
		PRINTFORML  [6] 基礎値ボーナス増加　　　　　　　　　　　　　{LOCAL:16,5,RIGHT} ポイント
	ELSE
		PRINTFORML  [6] 基礎値ボーナス増加　　　　　　　　なし
	ENDIF
	IF LOCAL:17
		PRINTFORML  [7] 初期防衛力増加　　　　　　　　　　　　　　　{LOCAL:17*500,5,RIGHT} ポイント
	ELSE
		PRINTFORML  [7] 初期防衛力増加　　　　　　　　　　なし
	ENDIF
	IF LOCAL:18
		PRINTL  [8] 触手の欠片引き継ぎ　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 4 || FLAG:200 == 0
			SETCOLOR 96,96,96
		PRINTL  [8] 触手の欠片引き継ぎ　　　　　　　　-4
		RESETCOLOR
	ENDIF
	IF LOCAL:19
		PRINTL  [9] 衣装引き継ぎ　　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 6
			SETCOLOR 96,96,96
		PRINTL  [9] 衣装引き継ぎ　　　　　　　　　　　-6
		RESETCOLOR
	ENDIF
	IF LOCAL:20
		PRINTL [10] 魅了経験引き継ぎ　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 6
			SETCOLOR 96,96,96
		PRINTL [10] 魅了経験引き継ぎ　　　　　　　　　-6
		RESETCOLOR
	ENDIF
ELSEIF NOWPAGE == 2
	PRINTPLAIN  周回向けオプション　　　　　　
	PRINTL  [0] このページの項目をすべて解除
	PRINTL 
	IF LOCAL:21
		PRINTL [11] 夜間自動回復アップ　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 8
			SETCOLOR 96,96,96
		PRINTL [11] 夜間自動回復アップ　　　　　　　　-8
		RESETCOLOR
	ENDIF
	IF LOCAL:22
		PRINTL [12] 絡みつく選択率ダウン　　　　　　　(選択済み)
	ELSE
		SIF (LOCAL:27 == 0 && POINTS < 6) || (LOCAL:27 && POINTS < 4)
			SETCOLOR 96,96,96
		PRINTL [12] 絡みつく選択率ダウン　　　　　　　-6
		RESETCOLOR
	ENDIF
	IF LOCAL:23
		PRINTL [13] 振り解く強化　　　　　　　　　　　(選択済み)
	ELSE
		SIF (LOCAL:28 == 0 && POINTS < 6) || (LOCAL:28 && POINTS < 1)
			SETCOLOR 96,96,96
		PRINTL [13] 振り解く強化　　　　　　　　　　　-6
		RESETCOLOR
	ENDIF
	IF LOCAL:24
		PRINTL [14] 洗脳/悪堕ちしやすい　　　　　　 　(選択済み)
	ELSE
		SIF POINTS < 3
			SETCOLOR 96,96,96
		PRINTL [14] 洗脳/悪堕ちしやすい　　　　　　　 -3
		RESETCOLOR
	ENDIF
	IF LOCAL:25
		PRINTL [15] 刻印怯み無効　　　　　　　　　　  (選択済み)
	ELSE
		SIF (LOCAL:30 == 0 && POINTS < 8) || (LOCAL:30 && POINTS < 6)
			SETCOLOR 96,96,96
		PRINTL [15] 刻印怯み無効　　　　　　　　　　  -8
		RESETCOLOR
	ENDIF
	IF LOCAL:26
		PRINTL [16] 日数制限解除　　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 30
			SETCOLOR 96,96,96
		PRINTL [16] 日数制限解除　　　　　　　　　　　-30
		RESETCOLOR
	ENDIF
	IF LOCAL:27
		PRINTL [17] 絡みつく選択率アップ　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 2 && LOCAL:22 == 0
			SETCOLOR 96,96,96
		PRINTL [17] 絡みつく選択率アップ　　　　　　　-2
		RESETCOLOR
	ENDIF
	IF LOCAL:28
		PRINTL [18] 振り解く弱化　　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 2 && LOCAL:23 == 0
			SETCOLOR 96,96,96
		PRINTL [18] 振り解く弱化　　　　　　　　　　　-2
		RESETCOLOR
	ENDIF
	IF LOCAL:29
		PRINTL [19] 妊娠確率アップ　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 3
			SETCOLOR 96,96,96
		PRINTL [19] 妊娠確率アップ　　　　　　　　　　-3
		RESETCOLOR
	ENDIF
	IF LOCAL:30
		PRINTL [20] 刻印怯み率２倍　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS < 2 && LOCAL:25 == 0
			SETCOLOR 96,96,96
		PRINTL [20] 刻印怯み率２倍　　　　　　　　　　-2
		RESETCOLOR
	ENDIF
ENDIF
DRAWLINE
IF NOWPAGE > 1
	PRINT [100]前のページへ　　　　　
ELSE
	PRINT                            
ENDIF
PRINTPLAINFORM PAGE < {NOWPAGE}/{PAGEMAX} >　　　　
SIF NOWPAGE < PAGEMAX
	PRINT [200]次のページへ
PRINTL 
PRINTL [999] 引き継ぎ開始
$INPUT_LOOP
INPUT
IF RESULT == 0 && NOWPAGE == 1
	NOWLINECOUNT = LINECOUNT
	$PRINT_LOOP_1
	LOCAL:10 = 0
	CALL SHORTLINE
	PRINTFORML 引き継ぎを行うキャラを選択してください。
	PRINTL 
	FOR CCOUNT, 0, CHARANUM
		SIF CCOUNT == MASTER
			CONTINUE
		SIF CFLAG:CCOUNT:231 && LOCAL:12 == 0
			SETCOLOR 96,96,96
		PRINTFORM  [{CCOUNT}] %NAME:CCOUNT,42,LEFT%　　　
		SIF CCOUNT < 10
			PRINT  
		IF CFLAG:CCOUNT:0 == 999
			PRINT ○引き継ぐ
			LOCAL:10 ++
		ELSE
			PRINT ×引き継がない
		ENDIF
		IF CFLAG:CCOUNT:231
			PRINT 　(娘)　
		ELSE
			PRINT 　　　　
		ENDIF
		PRINTL 
		RESETCOLOR
	NEXT
	PRINTL  [100] 全キャラ選択
	CALL SHORTLINE
	PRINTL [999] 選択完了
	$INPUT_LOOP_1
	INPUT
	IF RESULT <= CHARANUM -1 && RESULT != MASTER && (CFLAG:RESULT:231 == 0 || LOCAL:12)
		IF CFLAG:RESULT:0 == 999
			CFLAG:RESULT:0 = 0
		ELSE
			CFLAG:RESULT:0 = 999
		ENDIF
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_1
	ELSEIF RESULT == 100
		FOR CCOUNT, 0, CHARANUM
			SIF CCOUNT == MASTER
				CONTINUE
			SIF CFLAG:CCOUNT:231 == 0 || LOCAL:12
				CFLAG:CCOUNT:0 = 999
		NEXT
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_1
	ELSEIF RESULT == 999
		CALL LB
		GOTO MASTER_LOOP
	ELSE
		CLEARLINE 1
		GOTO INPUT_LOOP_1
	ENDIF
ELSEIF RESULT == 1 && (LOCAL:11 || POINTS >= 4) && NOWPAGE == 1
	IF LOCAL:11
		LOCAL:11 = 0
		POINTS += 4
	ELSE
		LOCAL:11 = 1
		POINTS -= 4
	ENDIF
ELSEIF RESULT == 2 && (LOCAL:12 || POINTS >= 15) && HAVE_DAUGHTER && NOWPAGE == 1
	IF LOCAL:12
		LOCAL:12 = 0
		POINTS += 15
		FOR CCOUNT, 0, CHARANUM
			IF CFLAG:CCOUNT:0 == 999 && CFLAG:CCOUNT:231
				CFLAG:CCOUNT:0 = 0
				LOCAL:10 --
			ENDIF
		NEXT
	ELSE
		LOCAL:12 = 1
		POINTS -= 15
	ENDIF
ELSEIF RESULT == 3 && (LOCAL:13 || POINTS >= 30) && GLOBAL:113 && NOWPAGE == 1
	IF LOCAL:13
		LOCAL:13 = 0
		POINTS += 30
	ELSE
		LOCAL:13 = 1
		POINTS -= 30
	ENDIF
ELSEIF RESULT == 4 && (LOCAL:14 || POINTS >= 8) && NOWPAGE == 1
	IF LOCAL:14
		LOCAL:14 = 0
		POINTS += 8
	ELSE
		LOCAL:14 = 1
		POINTS -= 8
	ENDIF
ELSEIF RESULT == 5 && NOWPAGE == 1
	NOWLINECOUNT = LINECOUNT
	$PRINT_LOOP_2
	LOCAL = LOCAL:15 * 4
	CALL SHORTLINE
	PRINTFORML 資金の引き継ぎ金額を選んでください。　　　　　 のこり周回ポイント ({POINTS - USED}pts.)
	PRINTL 
	PRINTFORML  [0]  引き継がない
	IF LOCAL:15 == 1
		PRINTFORML  [1]  25％引き継ぎ　{MONEY * 25 / 100,10,RIGHT}＄　　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS + LOCAL < 4
			SETCOLOR 96,96,96
		PRINTFORML  [1]  25％引き継ぎ　{MONEY * 25 / 100,10,RIGHT}＄　　　　　　　　　　　-4
		RESETCOLOR
	ENDIF
	IF LOCAL:15 == 2
		PRINTFORML  [2]  50％引き継ぎ　{MONEY * 50 / 100,10,RIGHT}＄　　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS + LOCAL < 8
			SETCOLOR 96,96,96
		PRINTFORML  [2]  50％引き継ぎ　{MONEY * 50 / 100,10,RIGHT}＄　　　　　　　　　　　-8
		RESETCOLOR
	ENDIF
	IF LOCAL:15 == 3
		PRINTFORML  [3]  75％引き継ぎ　{MONEY * 75 / 100,10,RIGHT}＄　　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS + LOCAL < 12
			SETCOLOR 96,96,96
		PRINTFORML  [3]  75％引き継ぎ　{MONEY * 75 / 100,10,RIGHT}＄　　　　　　　　　　　-12
		RESETCOLOR
	ENDIF
	IF LOCAL:15 == 4
		PRINTFORML  [4] 100％引き継ぎ　{MONEY,10,RIGHT}＄　　　　　　　　　　　(選択済み)
	ELSE
		SIF POINTS + LOCAL < 16
			SETCOLOR 96,96,96
		PRINTFORML  [4] 100％引き継ぎ　{MONEY,10,RIGHT}＄　　　　　　　　　　　-16
		RESETCOLOR
	ENDIF
	CALL SHORTLINE
	PRINTL [999] 選択完了
	$INPUT_LOOP_2
	INPUT
	IF RESULT == 0
		POINTS += LOCAL:15 * 4
		LOCAL:15 = 0
	ELSEIF RESULT == 1 && (LOCAL:15 == 1 || POINTS + LOCAL >= 4)
		IF LOCAL:15 != 1
			SIF LOCAL:15 >= 1
				POINTS += LOCAL:15 * 4
			LOCAL:15 = 1
			POINTS -= 4
		ELSE
			LOCAL:15 = 0
			POINTS += 4
		ENDIF
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_2
	ELSEIF RESULT == 2 && (LOCAL:15 == 2 || POINTS + LOCAL >= 8)
		IF LOCAL:15 != 2
			SIF LOCAL:15 >= 1
				POINTS += LOCAL:15 * 4
			LOCAL:15 = 2
			POINTS -= 8
		ELSE
			LOCAL:15 = 0
			POINTS += 8
		ENDIF
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_2
	ELSEIF RESULT == 3 && (LOCAL:15 == 3 || POINTS + LOCAL >= 12)
		IF LOCAL:15 != 3
			SIF LOCAL:15 >= 1
				POINTS += LOCAL:15 * 4
			LOCAL:15 = 3
			POINTS -= 12
		ELSE
			LOCAL:15 = 0
			POINTS += 12
		ENDIF
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_2
	ELSEIF RESULT == 4 && (LOCAL:15 == 4 || POINTS + LOCAL >= 16)
		IF LOCAL:15 != 4
			SIF LOCAL:15 >= 1
				POINTS += LOCAL:15 * 4
			LOCAL:15 = 4
			POINTS -= 16
		ELSE
			LOCAL:15 = 0
			POINTS += 16
		ENDIF
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_2
	ELSEIF RESULT == 999
		CALL LB
		GOTO MASTER_LOOP
	ELSE
		CLEARLINE 1
		GOTO INPUT_LOOP_2
	ENDIF
ELSEIF RESULT == 6 && NOWPAGE == 1
	NOWLINECOUNT = LINECOUNT
	$PRINT_LOOP_3
	CALL SHORTLINE
	PRINTFORML キャラエディットの際に使用する基礎値ボーナスを20ポイントまで獲得できます。
	PRINTFORML 周回ポイントを割り振ってください。　　　　　　 のこり周回ポイント ({POINTS - USED}pts.)
	PRINTL 
	PRINTFORML 　基礎値ボーナス：{LOCAL:16}
	PRINTL 
	PRINTFORM  [0] リセットする　　　　　　　　　
	SIF LOCAL:16 < 1
		SETCOLOR 96,96,96
	PRINTFORM [1]−１　　　
	RESETCOLOR
	SIF POINTS < 2 || LOCAL:16 >= 20
		SETCOLOR 96,96,96
	PRINTFORML [10]＋１
	RESETCOLOR
	CALL SHORTLINE
	PRINTL [999] 選択完了
	$INPUT_LOOP_3
	INPUT
	IF RESULT == 0
		POINTS += LOCAL:16 * 2
		LOCAL:16 = 0
		GOTO PRINT_LOOP_3
	ELSEIF RESULT == 1 && LOCAL:16
		LOCAL:16 -= 1
		POINTS += 2
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_3
	ELSEIF RESULT == 10 && POINTS >= 2 && LOCAL:16 < 20
		LOCAL:16 += 1
		POINTS -= 2
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_3
	ELSEIF RESULT == 999
		CALL LB
		GOTO MASTER_LOOP
	ELSE
		CLEARLINE 1
		GOTO INPUT_LOOP_3
	ENDIF
ELSEIF RESULT == 7 && NOWPAGE == 1
	NOWLINECOUNT = LINECOUNT
	$PRINT_LOOP_4
	CALL SHORTLINE
	PRINTFORML 初期防衛力を5000ポイントまで強化できます。
	PRINTFORML 周回ポイントを割り振ってください。　　　　　　 のこり周回ポイント ({POINTS - USED}pts.)
	PRINTL 
	PRINTFORML 　防衛力強化：{LOCAL:17*500}
	PRINTL 
	PRINTFORM  [0] リセットする　　　　　　　　　
	SIF LOCAL:17 < 1
		SETCOLOR 96,96,96
	PRINTFORM [1]−５００　　　
	RESETCOLOR
	SIF POINTS < 1 || LOCAL:17 >= 10
		SETCOLOR 96,96,96
	PRINTFORML [10]＋５００
	RESETCOLOR
	CALL SHORTLINE
	PRINTL [999] 選択完了
	$INPUT_LOOP_4
	INPUT
	IF RESULT == 0
		POINTS += LOCAL:17
		LOCAL:17 = 0
		GOTO PRINT_LOOP_4
	ELSEIF RESULT == 1 && LOCAL:17
		LOCAL:17 -= 1
		POINTS += 1
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_4
	ELSEIF RESULT == 10 && POINTS >= 1 && LOCAL:17 < 10
		LOCAL:17 += 1
		POINTS -= 1
		CLEARLINE LINECOUNT - NOWLINECOUNT
		GOTO PRINT_LOOP_4
	ELSEIF RESULT == 999
		CALL LB
		GOTO MASTER_LOOP
	ELSE
		CLEARLINE 1
		GOTO INPUT_LOOP_4
	ENDIF
ELSEIF RESULT == 8 && (LOCAL:18 || POINTS >= 4) && FLAG:200 && NOWPAGE == 1
	IF LOCAL:18
		LOCAL:18 = 0
		POINTS += 4
	ELSE
		LOCAL:18 = 1
		POINTS -= 4
	ENDIF
ELSEIF RESULT == 9 && (LOCAL:19 || POINTS >= 6) && NOWPAGE == 1
	IF LOCAL:19
		LOCAL:19 = 0
		POINTS += 6
	ELSE
		LOCAL:19 = 1
		POINTS -= 6
	ENDIF
ELSEIF RESULT == 10 && (LOCAL:20 || POINTS >= 6) && NOWPAGE == 1
	IF LOCAL:20
		LOCAL:20 = 0
		POINTS += 6
	ELSE
		LOCAL:20 = 1
		POINTS -= 6
	ENDIF
ELSEIF RESULT == 0 && NOWPAGE == 2
	IF LOCAL:21
		LOCAL:21 = 0
		POINTS += 8
	ENDIF
	IF LOCAL:22
		LOCAL:22 = 0
		POINTS += 6
	ENDIF
	IF LOCAL:23
		LOCAL:23 = 0
		POINTS += 6
	ENDIF
	IF LOCAL:24
		LOCAL:24 = 0
		POINTS += 3
	ENDIF
	IF LOCAL:25
		LOCAL:25 = 0
		POINTS += 8
	ENDIF
	IF LOCAL:26
		LOCAL:26 = 0
		POINTS += 30
	ENDIF
	IF LOCAL:27
		LOCAL:27 = 0
		POINTS += 2
	ENDIF
	IF LOCAL:28
		LOCAL:28 = 0
		POINTS += 2
	ENDIF
	IF LOCAL:29
		LOCAL:29 = 0
		POINTS += 3
	ENDIF
	IF LOCAL:30
		LOCAL:30 = 0
		POINTS += 2
	ENDIF
ELSEIF RESULT == 11 && (LOCAL:21 || POINTS >= 8) && NOWPAGE == 2
	IF LOCAL:21
		LOCAL:21 = 0
		POINTS += 8
	ELSE
		LOCAL:21 = 1
		POINTS -= 8
	ENDIF
ELSEIF RESULT == 12 && (LOCAL:22 || POINTS >= 6 || (LOCAL:27 && POINTS >= 4)) && NOWPAGE == 2
	IF LOCAL:22
		LOCAL:22 = 0
		POINTS += 6
	ELSE
		IF LOCAL:27
			LOCAL:27 = 0
			POINTS += 2
		ENDIF
		LOCAL:22 = 1
		POINTS -= 6
	ENDIF
ELSEIF RESULT == 13 && (LOCAL:23 || POINTS >= 6 || (LOCAL:28 && POINTS >= 4)) && NOWPAGE == 2
	IF LOCAL:23
		LOCAL:23 = 0
		POINTS += 6
	ELSE
		IF LOCAL:28
			LOCAL:28 = 0
			POINTS += 2
		ENDIF
		LOCAL:23 = 1
		POINTS -= 6
	ENDIF
ELSEIF RESULT == 14 && (LOCAL:24 || POINTS >= 3) && NOWPAGE == 2
	IF LOCAL:24
		LOCAL:24 = 0
		POINTS += 3
	ELSE
		LOCAL:24 = 1
		POINTS -= 3
	ENDIF
ELSEIF RESULT == 15 && (LOCAL:25 || POINTS >= 8 || (LOCAL:30 && POINTS >= 6)) && NOWPAGE == 2
	IF LOCAL:25
		LOCAL:25 = 0
		POINTS += 8
	ELSE
		IF LOCAL:30
			LOCAL:30 = 0
			POINTS += 2
		ENDIF
		LOCAL:25 = 1
		POINTS -= 8
	ENDIF
ELSEIF RESULT == 16 && (LOCAL:26 || POINTS >= 30) && NOWPAGE == 2
	IF LOCAL:26
		LOCAL:26 = 0
		POINTS += 30
	ELSE
		LOCAL:26 = 1
		POINTS -= 30
	ENDIF
ELSEIF RESULT == 17 && (LOCAL:27 || POINTS >= 2 || LOCAL:22) && NOWPAGE == 2
	IF LOCAL:27
		LOCAL:27 = 0
		POINTS += 2
	ELSE
		IF LOCAL:22
			LOCAL:22 = 0
			POINTS += 6
		ENDIF
		LOCAL:27 = 1
		POINTS -= 2
	ENDIF
ELSEIF RESULT == 18 && (LOCAL:28 || POINTS >= 2 || LOCAL:23) && NOWPAGE == 2
	IF LOCAL:28
		LOCAL:28 = 0
		POINTS += 2
	ELSE
		IF LOCAL:23
			LOCAL:23 = 0
			POINTS += 6
		ENDIF
		LOCAL:28 = 1
		POINTS -= 2
	ENDIF
ELSEIF RESULT == 19&& (LOCAL:29 || POINTS >= 3) && NOWPAGE == 2
	IF LOCAL:29
		LOCAL:29 = 0
		POINTS += 3
	ELSE
		LOCAL:29 = 1
		POINTS -= 3
	ENDIF
ELSEIF RESULT == 20 && (LOCAL:30 || POINTS >= 2 || LOCAL:25) && NOWPAGE == 2
	IF LOCAL:30
		LOCAL:30 = 0
		POINTS += 2
	ELSE
		IF LOCAL:25
			LOCAL:25 = 0
			POINTS += 8
		ENDIF
		LOCAL:30 = 1
		POINTS -= 2
	ENDIF
ELSEIF RESULT == 100 && NOWPAGE > 1
	NOWPAGE --
	GOTO MASTER_LOOP
ELSEIF RESULT == 200 && NOWPAGE < PAGEMAX
	NOWPAGE ++
	GOTO MASTER_LOOP
ELSEIF RESULT == 999
	IF LOCAL:10 == 0
		PRINTL 現在の引き継ぎ人数が 0人になっています。
		PRINTL キャラを引き継がずに次周を開始してもよろしいですか？
		PRINTL  [0] はい
		PRINTL  [1] いいえ
		$INPUT_LOOP_5
		INPUT
		IF RESULT == 0
		ELSEIF RESULT == 1
			CALL LB
			GOTO MASTER_LOOP
		ELSE
			CLEARLINE 1
			GOTO INPUT_LOOP_5
		ENDIF
	ENDIF

	;ゲームモード選択
	CALL LB
	PRINTL 次周を開始するにあたって、ゲームモードを選択し直すことができます
	PRINTW 
	NOWLINECOUNT = LINECOUNT
	$PRINT_LOOP_6
	DRAWLINE
	PRINTL ゲームモードを選んでください
	PRINT [0]NORMAL	
	PRINTPLAIN 複数人のキャラクターで敵の全滅を目指す通常プレイです
	PRINTL 
	SIF LOCAL:10 >= 2
		SETCOLOR 96,96,96
	PRINT [1]SOLO		
	PRINTPLAIN １人のキャラクターで挑むシンプルモードです、お手軽プレイ向け
	PRINTL 
	RESETCOLOR
	PRINT [2]HARDCORE	
	PRINTPLAIN 難易度の高い上級者向けのチャレンジモードです
	PRINTL 
	PRINT [3]ENDLESS	
	PRINTPLAIN 無限にボスが出現するモードです、難易度はNORMAL並み
	PRINTL 
	PRINTL 　　　　　　
	PRINTL [100]引き継ぎ選択に戻る
	$INPUT_LOOP_6
	INPUT
	IF RESULT == 0
		FLAG:0 = 1
		PRINTL NORMALモードで始まります
	ELSEIF RESULT == 1
		IF LOCAL:10 >= 2
			PRINTL 引き継ぎ人数が１人でなければSOLOモードは選択できません
			PRINTW 
			CLEARLINE 3
			CLEARLINE LINECOUNT - NOWLINECOUNT
			GOTO PRINT_LOOP_6
		ELSE
			FLAG:0 = 2
			PRINTL SOLOモードで始まります
		ENDIF
	ELSEIF RESULT == 2
		FLAG:0 = 4
		PRINTL HARDCOREモードで始まります
	ELSEIF RESULT == 3
		FLAG:0 = 10
		PRINTL ENDLESSモードのオプションを選択してください
		PRINTW 
		PRINTL 撃破成績に応じて周回プレイが可能な SURVIVAL と
		PRINTL 周回できないが撃破期限が存在しない FREEPLAY が選択可能です
		PRINTL [0]SURVIVAL (期限あり、周回可能)
		PRINTL [1]FREEPLAY (期限なし、周回不可)
		PRINTL 
		PRINTL [100]モード選択に戻る
		$INPUT_LOOP_6_3
		INPUT
		IF RESULT == 0
			LOCAL:26 = 0
			PRINTL ENDLESS:SURVIVALモードでプレイします
		ELSEIF RESULT == 1
			LOCAL:26 = 1
			PRINTL ENDLESS:FREEPLAYモードでプレイします
		ELSEIF RESULT == 100
			CALL LB
			GOTO PRINT_LOOP_6
		ELSE
			GOTO INPUT_LOOP_6_3
		ENDIF
	ELSEIF RESULT == 100
		CALL LB
		GOTO MASTER_LOOP
	ELSE
		CLEARLINE 1
		GOTO INPUT_LOOP_6
	ENDIF
	;フラグ初期化処理
	DAY = 0
	DAY:1 = 0
	TIME = 0
	FOR LOCAL,1,5
		FLAG:LOCAL = 0
	NEXT
	FOR LOCAL,9,22
		FLAG:LOCAL = 0
	NEXT
	FOR LOCAL,41,64
		FLAG:LOCAL = 0
	NEXT
	FOR LOCAL,65,112
		FLAG:LOCAL = 0
	NEXT
	FOR LOCAL,300,800
		FLAG:LOCAL = 0
	NEXT
	FOR LOCAL,900,999
		FLAG:LOCAL = 0
	NEXT
	;周回要素フラグを立てる
	FOR LOCAL,21,31
		FLAG:(880+LOCAL) = LOCAL:LOCAL
	NEXT

	;ボス1匹当たりの制限日数
	IF FLAG:0 == 4
		FLAG:2 = 15
	ELSEIF FLAG:0 == 2
		FLAG:2 = 15
	ELSE
		FLAG:2 = 12
	ENDIF
	;鍛錬設備レベル
	FLAG:50 = 1
	FLAG:51 = 1
	FLAG:52 = 0
	FLAG:53 = 0

	;ボス触手、ラスボス触手の総数
	CALL GET_BOSS_ERB_NUM
	FLAG:3 = RESULT
	;Ｋ触手のみカウント
	FLAG:4 = 1

	;ボス触手、ラスボス触手のフラグ設定
	REPEAT FLAG:3
		SETBIT FLAG:100, COUNT
	REND
	SETBIT FLAG:101, 0

	;制限日数の設定
	;(ボス触手の総数*１体当たりの制限日数)＋(ラスボス触手の総数*10)で算出
	IF FLAG:0 != 10
		FLAG:1 = (FLAG:3 * FLAG:2) + (FLAG:4 * 10)
	ENDIF

	;引き継ぎ開始
	FOR CCOUNT, 0, CHARANUM
		SIF CCOUNT == MASTER
			CONTINUE
		SIF CHARANUM - CCOUNT == 0
			BREAK

		IF CFLAG:CCOUNT:0 == 999
			TALENT:CCOUNT:初期経験設定不可 = 1
			;性成長引き継ぎしない
			IF LOCAL:11 == 0
				FOR LOCAL,0,25
					ABL:CCOUNT:LOCAL = CSVABL_F(NO:CCOUNT,LOCAL)
				NEXT
				FOR LOCAL,10,58
					EXP:CCOUNT:LOCAL = CSVEXP_F(NO:CCOUNT,LOCAL)
				NEXT
				FOR LOCAL,0,5
					MARK:CCOUNT:LOCAL = CSVMARK_F(NO:CCOUNT,LOCAL)
				NEXT
				FOR LOCAL,90,95
					MARK:CCOUNT:LOCAL = CSVMARK_F(NO:CCOUNT,LOCAL)
				NEXT
				FOR LOCAL,30,33
					CFLAG:CCOUNT:LOCAL = CSVCFLAG_F(NO:CCOUNT,LOCAL)
				NEXT
				FOR LOCAL,35,37
					CFLAG:CCOUNT:LOCAL = CSVCFLAG_F(NO:CCOUNT,LOCAL)
				NEXT
				FOR LOCAL,200,239
					CFLAG:CCOUNT:LOCAL = CSVCFLAG_F(NO:CCOUNT,LOCAL)
				NEXT
				;口上用CFLAGは性経験に絡んでいることが多いのでここで初期化
				FOR LOCAL,250,999
					CFLAG:CCOUNT:LOCAL = CSVCFLAG_F(NO:CCOUNT,LOCAL)
				NEXT
				TALENT:CCOUNT:母乳体質 = CSVTALENT_F(NO:CCOUNT,1)
				TALENT:CCOUNT:お漏らし癖 = CSVTALENT_F(NO:CCOUNT,2)
				TALENT:CCOUNT:触手の虜 = CSVTALENT_F(NO:CCOUNT,150)
				TALENT:CCOUNT:淫乱 = CSVTALENT_F(NO:CCOUNT,151)
				TALENT:CCOUNT:精神崩壊 = CSVTALENT_F(NO:CCOUNT,152)
				TALENT:CCOUNT:淫核 = CSVTALENT_F(NO:CCOUNT,153)
				TALENT:CCOUNT:淫壷 = CSVTALENT_F(NO:CCOUNT,154)
				TALENT:CCOUNT:淫尻 = CSVTALENT_F(NO:CCOUNT,155)
				TALENT:CCOUNT:淫乳 = CSVTALENT_F(NO:CCOUNT,156)
				TALENT:CCOUNT:妊娠 = CSVTALENT_F(NO:CCOUNT,159)
				TALENT:CCOUNT:寄生 = CSVTALENT_F(NO:CCOUNT,160)
				TALENT:CCOUNT:苗床化 = CSVTALENT_F(NO:CCOUNT,161)
				;固有キャラならばCSVに合わせる
				IF TALENT:CCOUNT:固有キャラ > 0
					TALENT:CCOUNT:未熟 = CSVTALENT_F(NO:CCOUNT,4)
					TALENT:CCOUNT:ふたなり = CSVTALENT_F(NO:CCOUNT,300)
				;固有キャラ以外の場合
				ELSE
					SIF TALENT:CCOUNT:ふたなり != 3 && TALENT:CCOUNT:ふたなり != -3
						TALENT:CCOUNT:ふたなり = CSVTALENT_F(NO:CCOUNT,300)
				ENDIF
				;射精と噴乳の最大値は射精中毒と噴乳中毒で変動する
				MAXBASE:CCOUNT:射精 = CSVBASE_F(NO:CCOUNT, 20)
				MAXBASE:CCOUNT:噴乳 = CSVBASE_F(NO:CCOUNT, 21)
				;返り血などで変化した敏感・鈍感を元に戻す
				SIF TALENT:CCOUNT:Ｖ敏感 > 9
					TALENT:CCOUNT:Ｖ敏感 -= 10
				SIF TALENT:CCOUNT:Ａ敏感 > 9
					TALENT:CCOUNT:Ａ敏感 -= 10
				SIF TALENT:CCOUNT:Ｂ敏感 > 9
					TALENT:CCOUNT:Ｂ敏感 -= 10
				SIF TALENT:CCOUNT:Ｃ敏感 > 9
					TALENT:CCOUNT:Ｃ敏感 -= 10
				SIF TALENT:CCOUNT:Ｖ鈍感 < -8
					TALENT:CCOUNT:Ｖ鈍感 += 10
				SIF TALENT:CCOUNT:Ａ鈍感 < -8
					TALENT:CCOUNT:Ａ鈍感 += 10
				SIF TALENT:CCOUNT:Ｂ鈍感 < -8
					TALENT:CCOUNT:Ｂ鈍感 += 10
				SIF TALENT:CCOUNT:Ｃ鈍感 < -8
					TALENT:CCOUNT:Ｃ鈍感 += 10

				;処女を奪われている場合は処女に戻す
				SIF TALENT:CCOUNT:処女 == -1
					TALENT:CCOUNT:処女 = 1
				;清純派が失われている場合は清純派に戻す
				SIF TALENT:CCOUNT:清純派 == -1
					TALENT:CCOUNT:清純派 = 1
				;変身時非処女を消去
				TALENT:CCOUNT:変身時非処女 = 0

				;素質基本値の読み込み
				IF BASE:CCOUNT:体格基本値 < 0
					TALENT:CCOUNT:小柄 = 1
				ELSEIF BASE:CCOUNT:体格基本値 > 0
					TALENT:CCOUNT:長身 = 1
				ENDIF
				IF BASE:CCOUNT:胸サイズ基本値 == -2
					TALENT:CCOUNT:貧乳 = 2
				ELSEIF BASE:CCOUNT:胸サイズ基本値 == -1
					TALENT:CCOUNT:貧乳 = 1
				ELSEIF BASE:CCOUNT:胸サイズ基本値 == 3
					TALENT:CCOUNT:巨乳 = 3
				ELSEIF BASE:CCOUNT:胸サイズ基本値 == 2
					TALENT:CCOUNT:巨乳 = 2
				ELSEIF BASE:CCOUNT:胸サイズ基本値 == 1
					TALENT:CCOUNT:巨乳 = 1
				ENDIF
				TALENT:CCOUNT:変身時体格変動 = MAXBASE:CCOUNT:体格基本値
				TALENT:CCOUNT:変身時胸サイズ変動 = MAXBASE:CCOUNT:胸サイズ基本値
				TALENT:CCOUNT:外見 = BASE:CCOUNT:外見基本値
				TALENT:CCOUNT:変身時外見 = MAXBASE:CCOUNT:外見基本値

				SIF BASE:CCOUNT:性別基本値 == 2
					TALENT:CCOUNT:ふたなり = 3
				SIF MAXBASE:CCOUNT:性別基本値 == 2
					TALENT:CCOUNT:変身時ふたなり = 3

				;ＴＳ関連の処理
				;♂/＊⇒♀/＊　元の性別が女体化している場合
				IF TALENT:CCOUNT:性別変化 % 10 == 1
					;元の性別をオトコに戻す
					TALENT:CCOUNT:オトコ = 1
					TALENT:CCOUNT:処女 = 0
					TALENT:CCOUNT:母乳体質 = 0
					TALENT:CCOUNT:パイパン = 0
					TALENT:CCOUNT:Ｖ敏感 = 0
					TALENT:CCOUNT:Ｖ鈍感 = 0
					TALENT:CCOUNT:濡れやすい = 0
					TALENT:CCOUNT:濡れにくい = 0
					TALENT:CCOUNT:苗床化 = 0
					TALENT:CCOUNT:ふたなり = 0
					SIF TALENT:CCOUNT:交際相手 == 2 || TALENT:CCOUNT:交際相手 == 4 || TALENT:CCOUNT:交際相手 == 5
						TALENT:CCOUNT:交際相手 = 0
					TALENT:CCOUNT:アクセサリ = 0
					TALENT:CCOUNT:外見 = 0
					;プロフィール再設定
					CALL GENERATE_CHAR_SIZE, CCOUNT, 0
					BASE:CCOUNT:身長 = RESULT:2
					BASE:CCOUNT:体重 = RESULT:3
					BASE:CCOUNT:胸囲 = RESULT:4
					BASE:CCOUNT:胴囲 = RESULT:5
					BASE:CCOUNT:腰囲 = RESULT:6
				ENDIF
				;＊/♂⇒＊/♀　変身時の性別が女体化している場合
				IF TALENT:CCOUNT:性別変化 / 10 == 1
					;プロフィール再設定
					CALL GENERATE_CHAR_SIZE, CCOUNT, 1
					MAXBASE:CCOUNT:身長 = RESULT:2
					MAXBASE:CCOUNT:体重 = RESULT:3
					MAXBASE:CCOUNT:胸囲 = RESULT:4
					MAXBASE:CCOUNT:胴囲 = RESULT:5
					MAXBASE:CCOUNT:腰囲 = RESULT:6
				ENDIF
				;変身時ＴＳの復活
				SIF TALENT:CCOUNT:変身時ＴＳ == -1
					TALENT:CCOUNT:変身時ＴＳ = 1
				;性別変化情報をリセット	
				TALENT:CCOUNT:性別変化 = 0
				SIF TALENT:CCOUNT:女体受容 > 0
					SWAP TALENT:男性苦手,TALENT:女性苦手
				TALENT:CCOUNT:女体受容 = 0
				;初期経験の設定を許可する
				TALENT:CCOUNT:初期経験設定不可 = 0
			ENDIF
			;レベル引き継ぎしない
			IF LOCAL:13 == 0
				ABL:CCOUNT:レベル = CSVABL_F(NO:CCOUNT,50)
				;コネクション
				FOR LOCAL,120,124
					CFLAG:CCOUNT:LOCAL = CSVCFLAG_F(NO:CCOUNT,LOCAL)
				NEXT
			ENDIF
			;戦技引き継ぎしない
			IF LOCAL:14 == 0
				FOR LOCAL,30,34
					ABL:CCOUNT:LOCAL = CSVABL_F(NO:CCOUNT,LOCAL)
				NEXT
				FOR LOCAL,5,8
					EXP:CCOUNT:LOCAL = CSVEXP_F(NO:CCOUNT,LOCAL)
				NEXT
			ENDIF
			;衣装引き継ぎしない
			IF LOCAL:19 == 0
				FOR LOCAL,40,44
					CFLAG:CCOUNT:LOCAL = CSVCFLAG_F(NO:CCOUNT,LOCAL)
				NEXT
				FOR LOCAL,600,700
					EQUIP:CCOUNT:LOCAL = 0
				NEXT
			ENDIF
			;魅了経験引き継ぎしない
			IF LOCAL:20 == 0
				EXP:CCOUNT:58 = CSVCFLAG_F(NO:CCOUNT,58)
			;魅了経験を引き継ぐ場合、100を上回った分は25%のみ引き継ぎ
			ELSEIF EXP:CCOUNT:58 > 100
				EXP:CCOUNT:58 = 100 + (EXP:CCOUNT:58 - 100) / 4
			ENDIF

			;必ず初期化する項目
			FOR LOCAL,0,53
				;プロフィールは初期化しない
				SIF LOCAL >= 40 && LOCAL <48
					CONTINUE
				;噴乳と射精は性成長引継ぎの方で処理する
				SIF LOCAL == 20 || LOCAL == 21
					CONTINUE
				BASE:CCOUNT:LOCAL = CSVBASE_F(NO:CCOUNT,LOCAL)
				MAXBASE:CCOUNT:LOCAL = BASE:CCOUNT:LOCAL
			NEXT
			FOR LOCAL,0,3
				EXP:CCOUNT:LOCAL = CSVEXP_F(NO:CCOUNT,LOCAL)
			NEXT
			FOR LOCAL,0,51
				JUEL:CCOUNT:LOCAL = CSVJUEL_F(NO:CCOUNT,LOCAL)
			NEXT
			CFLAG:CCOUNT:0 = CSVCFLAG_F(NO:CCOUNT,0)
			FOR LOCAL,20,32
				CFLAG:CCOUNT:LOCAL = CSVCFLAG_F(NO:CCOUNT,LOCAL)
			NEXT
			FOR LOCAL,99,119
				CFLAG:CCOUNT:LOCAL = CSVCFLAG_F(NO:CCOUNT,LOCAL)
			NEXT
			FOR LOCAL,90,95
				MARK:CCOUNT:LOCAL = CSVMARK_F(NO:CCOUNT,LOCAL)
			NEXT
			CFLAG:CCOUNT:999 = 0
			;娘の場合、基礎値に修正を加える
			IF CFLAG:CCOUNT:231
				BASE:CCOUNT:0 += CFLAG:CCOUNT:60
				BASE:CCOUNT:1 += CFLAG:CCOUNT:61
				BASE:CCOUNT:2 += CFLAG:CCOUNT:62
				BASE:CCOUNT:50 += CFLAG:CCOUNT:60
				BASE:CCOUNT:51 += CFLAG:CCOUNT:61
				BASE:CCOUNT:52 += CFLAG:CCOUNT:62
				BASE:CCOUNT:10 += CFLAG:CCOUNT:63
				BASE:CCOUNT:11 += CFLAG:CCOUNT:64
				BASE:CCOUNT:12 += CFLAG:CCOUNT:65
				BASE:CCOUNT:13 += CFLAG:CCOUNT:66
			ENDIF
			;汎用キャラの体力などのBASE値の計算
			IF NO:CCOUNT == 0
				CALL SEIKAKU_CHECK,"GET_TALENT_VALUE",CCOUNT
				LOCAL = RESULT
				LOCAL:1 = 0
				LOCAL:2 = 0
				FOR LOCAL:3, 0, 7
					LOCAL:1 = LOCAL:3
					SIF LOCAL:3 > 2
						LOCAL:1 = LOCAL:3 + 7
					LOCAL:2 = BASE:CCOUNT:(LOCAL:1)
					;性格補正
					BASE:CCOUNT:(LOCAL:1) = SEIKAKU_HOSEI_F(LOCAL, LOCAL:1, LOCAL:2)
					MAXBASE:CCOUNT:(LOCAL:1) = BASE:CCOUNT:(LOCAL:1)
				NEXT
			ENDIF
			;変身している場合、変身を解除する
			CALL TRANSFORM, 0, CCOUNT

			;射精ゲージ、噴乳ゲージのリセット
			BASE:CCOUNT:射精 = 0
			BASE:CCOUNT:噴乳 = 0
		ELSE
			;消去する予定のキャラを最後尾に持っていく
			FOR CCOUNT:1, CCOUNT, CHARANUM - 1
				SIF CCOUNT:1 == MASTER
					CONTINUE
				SWAPCHARA CCOUNT:1, CCOUNT:1 + 1
				;RELATIONの入れ替え
				FOR CCOUNT:2, 0, CHARANUM
					SIF LOCAL == MASTER
						CONTINUE
					SWAP RELATION:(CCOUNT:2):(CCOUNT:1), RELATION:(CCOUNT:2):(CCOUNT:1 + 1)
				NEXT
			NEXT
			;消去する予定のキャラのRELATIONを双方向とも初期化
			FOR CCOUNT:1, 0, CHARANUM
				SIF CCOUNT:1 == MASTER
					CONTINUE
				RELATION:(CHARANUM - 1):(CCOUNT:1) = 0
				RELATION:(CCOUNT:1):(CHARANUM - 1) = 0
			NEXT
			;消去の処理
			DELCHARA CHARANUM - 1
			CCOUNT --
			CONTINUE
		ENDIF
	NEXT
	;資金引き継ぎ
	MONEY = MONEY * 25 * LOCAL:15 / 100 + 1000
	;初期防衛力増加
	FLAG:852 = 5000 + LOCAL:17 * 500
	;触手の欠片引き継ぎなし
	SIF LOCAL:18 == 0
		FLAG:200 = 0
	;衣装引き継ぎなし
	IF LOCAL:19 == 0
		FOR LOCAL,101,200
			ITEM:LOCAL = 0
		NEXT
		FOR LOCAL,301,400
			ITEM:LOCAL = 0
		NEXT
		FOR LOCAL,401,500
			ITEM:LOCAL = 0
		NEXT
		FOR LOCAL,500,600
			ITEM:LOCAL = 0
		NEXT
		FOR LOCAL,600,700
			ITEM:LOCAL = 0
		NEXT
	ENDIF
	;各種周回特典フラグの処理
	FOR LCOUNT, 21,31
		IF LOCAL:LCOUNT > 0
			FLAG:(880+LCOUNT) = 1
		ELSE
			FLAG:(880+LCOUNT) = 0
		ENDIF
	NEXT

	IF FLAG:0 == 2
		LOCAL = 1
	ELSE
		;引き継いだ人数をLOCALに代入
		LOCAL = LOCAL:10
		;引き継ぎ人数が3人未満なら3人をデフォルトにする
		SIF LOCAL < 3
			LOCAL = 3
		IF (GLOBAL:100 + GLOBAL:101 + GLOBAL:102) > 0 && LOCAL < 7
			PRINTL 
			PRINTFORML 周回クリアボーナス：
			PRINTFORML ゲーム開始時の人数を増減できます
			SIF LOCAL:10 < 3
				PRINTFORML [-1] １人減らす　　　　　　　　　　（{LOCAL - 1}人で開始）
			PRINTFORML [ 0] デフォルト　　　　　　　　　　（{LOCAL}人で開始）
			SIF LOCAL:10 < 6
				PRINTFORML [ 1] １人増やす　　　　　　　　　　（{LOCAL + 1}人で開始）
			SIF LOCAL:10 < 5
				PRINTFORML [ 2] ２人増やす　　　　　　　　　　（{LOCAL + 2}人で開始）
			SIF LOCAL:10 < 4
				PRINTFORML [ 3] ３人増やす　　　　　　　　　　（{LOCAL + 3}人で開始）
			$INPUT_LOOP_CHARA_NUM
			INPUT
			IF RESULT >= 0 && RESULT <= 3 && LOCAL:10 + RESULT < 7
				LOCAL = LOCAL + RESULT
				PRINTFORML {LOCAL}人で開始します
			ELSEIF RESULT == -1 && LOCAL:10 < 3
				LOCAL = 2
				PRINTFORML {LOCAL}人で開始します
			ELSE
				GOTO INPUT_LOOP_CHARA_NUM
			ENDIF
		ENDIF
	ENDIF
	LOCAL = LOCAL - LOCAL:10
	IF LOCAL > 0
		PRINTFORMW 新規キャラを {LOCAL}人作成しました
		REPEAT LOCAL
			ADDCHARA 0
			FLAG:8 ++
		REND
	ENDIF
	PRINTL 
	;ソロモード以外でデフォルト人数でなかった場合は制限日数が変動する
	IF FLAG:0 != 2
		FLAG:2 -= MIN(CHARANUM - 4, 3)
		SIF FLAG:0 != 10
			FLAG:1 = (FLAG:3 * FLAG:2) + (FLAG:4 * 10)
	ENDIF

	;修練Ｐの処理
	FOR CCOUNT, 0, CHARANUM
		SIF CCOUNT == MASTER
			CONTINUE
		;使用済みボーナスの分だけ減算
		JUEL:CCOUNT:修練P -= CFLAG:CCOUNT:50 * 10
		JUEL:CCOUNT:修練P -= CFLAG:CCOUNT:51 * 10
		JUEL:CCOUNT:修練P -= CFLAG:CCOUNT:52 * 10
		JUEL:CCOUNT:修練P -= CFLAG:CCOUNT:53 * 10
		JUEL:CCOUNT:修練P -= CFLAG:CCOUNT:54 * 10
		JUEL:CCOUNT:修練P -= CFLAG:CCOUNT:55 * 10
		JUEL:CCOUNT:修練P -= CFLAG:CCOUNT:56 * 10
		SIF TALENT:CCOUNT:近距離得意
			JUEL:CCOUNT:修練P -= 150
		SIF TALENT:CCOUNT:中距離得意
			JUEL:CCOUNT:修練P -= 150
		SIF TALENT:CCOUNT:遠距離得意
			JUEL:CCOUNT:修練P -= 150
		SIF TALENT:CCOUNT:空中得意
			JUEL:CCOUNT:修練P -= 150
		SIF TALENT:CCOUNT:回復早い
			JUEL:CCOUNT:修練P -= 150
		SIF TALENT:CCOUNT:Ｃ結界
			JUEL:CCOUNT:修練P -= 50
		SIF TALENT:CCOUNT:Ｖ結界
			JUEL:CCOUNT:修練P -= 50
		SIF TALENT:CCOUNT:Ａ結界
			JUEL:CCOUNT:修練P -= 50
		SIF TALENT:CCOUNT:Ｂ結界
			JUEL:CCOUNT:修練P -= 50
		SIF TALENT:CCOUNT:避妊結界
			JUEL:CCOUNT:修練P -= 50
		SIF TALENT:CCOUNT:噂好きの友人
			JUEL:CCOUNT:修練P -= 50
		SIF TALENT:CCOUNT:警察関係者 == 1
			JUEL:CCOUNT:修練P -= 100
		SIF TALENT:CCOUNT:警察関係者 == 2
			JUEL:CCOUNT:修練P -= 200
		SIF TALENT:CCOUNT:情報屋
			JUEL:CCOUNT:修練P -= 150
		SIF TALENT:CCOUNT:裕福な実家
			JUEL:CCOUNT:修練P -= 100

		SIF TALENT:CCOUNT:近距離苦手
			JUEL:CCOUNT:修練P += 50
		SIF TALENT:CCOUNT:中距離苦手
			JUEL:CCOUNT:修練P += 50
		SIF TALENT:CCOUNT:遠距離苦手
			JUEL:CCOUNT:修練P += 50
		SIF TALENT:CCOUNT:空中苦手
			JUEL:CCOUNT:修練P += 50
		SIF TALENT:CCOUNT:回復遅い
			JUEL:CCOUNT:修練P += 50


		SIF JUEL:CCOUNT:修練P < 0
			JUEL:CCOUNT:修練P = 0

		JUEL:CCOUNT:修練P += LOCAL:16 * 10
	NEXT

	;TARGETを存在するキャラに設定
	FOR LOCAL,0,CHARANUM
		SIF LOCAL == MASTER
			CONTINUE
		TARGET = LOCAL
	NEXT

	;キャラメイキングへ飛ぶ
	CALL CHARA_MAKE_MAIN, LOCAL:16
	PRINTL 

	;キャラクターデフォルト設定
	CALL CHARA_MAKE_DEFAULT

	;専用口上の番号を設定、結界の耐久力を全快
	FOR CCOUNT, 0, CHARANUM
		SIF CCOUNT == MASTER
			CONTINUE
		SIF CFLAG:CCOUNT:6 == 0 || CFLAG:CCOUNT:6 >= 100
			CFLAG:CCOUNT:6 = NO:CCOUNT
		;部位結界の設定
		CALL BASEUP_CAL_SHIELD, CCOUNT
	NEXT

	;口上の初期設定を呼び出しなど
	FOR LOCAL,0,CHARANUM
		SIF LOCAL == MASTER
			CONTINUE

		TARGET = LOCAL
		SIF CFLAG:0 != 0 && CFLAG:20 == 0 && CFLAG:21 == 0
			CFLAG:21 = RAND:7 + 1

		CALL MESSAGE_FIRST

		SIF LOCAL <= パーティ人数最大値
			CFLAG:999 = 1
	NEXT

	;防衛力減衰回避
	FLAG:41 = 1
	;探索ノルマを設定
	CALL RESEARCH_QUOTA

	;フラッシュニュース用文字列をリセット
	SAVESTR:21 =
	SAVESTR:22 =
	SAVESTR:23 =
	SAVESTR:24 =
	SAVESTR:25 =
	SAVESTR:26 =

	FLAG:64 = -1
	BEGIN SHOP
ELSE
	CLEARLINE 1
	GOTO INPUT_LOOP
ENDIF
CLEARLINE LINECOUNT - NOWLINECOUNT
GOTO MASTER_LOOP












