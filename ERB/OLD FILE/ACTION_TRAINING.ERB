;--------------------------------------------------
;鍛錬
@TRAINING
LOCAL:0 = 0
LOCAL:1 = 0
LOCAL:2 = 0
LOCAL:3 = 0
LOCAL:4 = 0
LOCAL:99 = 0
LOCAL:100 = 0
LOCAL:101 = 0

;基本の基礎値上昇量
;体力、気力の上昇量
LOCAL:0 = 45 + FLAG:50 * 25 / 100
;性耐性、攻撃、防御、敏捷、知性の上昇量
LOCAL:1 = 3 + FLAG:50 / 2
SIF FLAG:0 != 4
	LOCAL:1 += 2
;○距離戦闘経験の上昇量
LOCAL:2 = 7 + FLAG:50 / 2
;経験Ｐの上昇量
LOCAL:3 = 2 + RAND:(5 + FLAG:50 * 2)
;子供の血族補正
TRYCALL TRAINING_HOSEI_CHILD,LOCAL:0
LOCAL:0 = RESULT
TRYCALL TRAINING_HOSEI_CHILD,LOCAL:1
LOCAL:1 = RESULT
TRYCALL TRAINING_HOSEI_CHILD,LOCAL:2
LOCAL:2 = RESULT

;基本の体力減少量
CALL TRAINING_DOWNTAIRYOKU,TARGET
LOCAL:4 = RESULT
PRINTL 

;口上呼び出し：鍛練開始
CALL MESSAGE_TRAINING_BEGIN

PRINTL どの鍛錬を行いますか？
PRINTFORML 現在の設備レベル：Lv.{FLAG:50}　消費体力：{LOCAL:4}

$INPUT_LOOP_SELECT
DRAWLINE
CALL SHOW_STATUS_BASE_TRAINING, TARGET

PRINTFORMLC [0] 走りこみ
PRINTFORMLC [1] 精神鍛錬
PRINTFORMLC [2] 瞑想
PRINTL 
PRINTFORMLC [3] 筋トレ
PRINTFORMLC [4] 自衛訓練
PRINTFORMLC [5] ダッシュ
PRINTL 
IF TALENT:変身能力 != -1
	PRINTFORMLC [6] 近距離戦闘訓練
	PRINTFORMLC [7] 中距離戦闘訓練
	PRINTFORMLC [8] 遠距離戦闘訓練
	PRINTL 
ENDIF
PRINTFORMLC [9] 戦術研究
SIF TALENT:変身能力 == -1
	PRINTFORMLC [10]戦闘基礎訓練
PRINTL 
DRAWLINE

IF CFLAG:110 > 0
	CALL RES_SCHEDULE, 110
ELSE
	$INPUT_LOOP
	INPUT
ENDIF

PRINTL 
IF RESULT == 0
	;地の文：鍛錬走りこみ
	CALL MESSAGE_TRAINING_HASHIRI

	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)
	LOCAL:100 = LOCAL:0

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "TAIRYOKU", TARGET, LOCAL:100
ELSEIF RESULT == 1
	;地の文：鍛錬精神鍛錬
	CALL MESSAGE_TRAINING_SEISHIN

	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)
	LOCAL:100 = LOCAL:0

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "KIRYOKU", TARGET, LOCAL:100
ELSEIF RESULT == 2
	;地の文：鍛錬瞑想
	CALL MESSAGE_TRAINING_MEISOU

	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)
	LOCAL:100 = LOCAL:1

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "SEITAISEI", TARGET, LOCAL:100
ELSEIF RESULT == 3
	;地の文：鍛錬筋トレ
	CALL MESSAGE_TRAINING_KINTORE

	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)
	LOCAL:100 = LOCAL:1

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "KOUGEKI", TARGET, LOCAL:100
ELSEIF RESULT == 4
	;地の文：鍛錬自衛訓練
	CALL MESSAGE_TRAINING_JIEI

	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)
	LOCAL:100 = LOCAL:1

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "BOUGYO", TARGET, LOCAL:100

ELSEIF RESULT == 5
	;地の文：鍛錬ダッシュ
	CALL MESSAGE_TRAINING_DASH

	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)
	LOCAL:100 = LOCAL:1

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "BINSYOU", TARGET, LOCAL:100
ELSEIF RESULT == 6 && TALENT:変身能力 != -1
	;地の文：鍛錬近距離戦闘訓練
	CALL MESSAGE_TRAINING_SHORT

	TIMES LOCAL:1, 0.30
	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:1, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	LOCAL:100 = LOCAL:1
	CALL BASEUP, "KOUGEKI", TARGET, LOCAL:100
	LOCAL:100 = LOCAL:1
	CALL BASEUP, "BINSYOU", TARGET, LOCAL:100

	EXP:近距離戦闘経験 += LOCAL:2
	PRINTFORML 近距離戦闘が\@(LOCAL:2 <= 3 + FLAG:50) ?少し #\@上達した（＋{LOCAL:2}）
	CALL SENGIUP, TARGET, 0
ELSEIF RESULT == 7 && TALENT:変身能力 != -1
	;地の文：鍛錬中距離戦闘訓練
	CALL MESSAGE_TRAINING_MIDDLE

	TIMES LOCAL:1, 0.30
	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:1, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	LOCAL:100 = LOCAL:1
	CALL BASEUP, "KOUGEKI", TARGET, LOCAL:100
	LOCAL:100 = LOCAL:1
	CALL BASEUP, "BOUGYO", TARGET, LOCAL:100

	EXP:中距離戦闘経験 += LOCAL:2
	PRINTFORML 中距離戦闘が\@(LOCAL:2 <= 3 + FLAG:50) ?少し #\@上達した（＋{LOCAL:2}）
	CALL SENGIUP, TARGET, 1
ELSEIF RESULT == 8 && TALENT:変身能力 != -1
	;地の文：鍛錬遠距離戦闘訓練
	CALL MESSAGE_TRAINING_LONG

	TIMES LOCAL:1, 0.30
	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:1, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	LOCAL:100 = LOCAL:1
	CALL BASEUP, "BOUGYO", TARGET, LOCAL:100
	LOCAL:100 = LOCAL:1
	CALL BASEUP, "BINSYOU", TARGET, LOCAL:100

	EXP:遠距離戦闘経験 += LOCAL:2
	PRINTFORML 遠距離戦闘が\@(LOCAL:2 <= 3 + FLAG:50) ?少し #\@上達した（＋{LOCAL:2}）
	CALL SENGIUP, TARGET, 2
ELSEIF RESULT == 9
	;地の文：戦術研究
	CALL MESSAGE_TRAINING_TACTICS

	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)
	LOCAL:100 = LOCAL:1

	;非戦闘員は知性の伸びにボーナス
	SIF TALENT:変身能力 == -1
		TIMES LOCAL:100,1.5

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "CHISEI", TARGET, LOCAL:100
ELSEIF RESULT == 10 && TALENT:変身能力 == -1
	;地の文：戦闘基礎訓練
	CALL MESSAGE_TRAINING_BASIS

	TIMES LOCAL:1, 0.30
	BASE:体力 =  LIMIT(BASE:体力 - LOCAL:4, 0, MAXBASE:体力)

	;触手拘束具を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:1, 0.8
		;地の文：触手拘束具が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	LOCAL:100 = LOCAL:1
	CALL BASEUP, "CHISEI", TARGET, LOCAL:100

	LOCAL:2 = LOCAL:2 * (150 + ABL:戦闘基礎 * 50) / 100 + RAND:3
	EXP:戦闘基礎経験 += LOCAL:2
	PRINTFORML 戦闘の基礎が\@(LOCAL:2 <= 30 + FLAG:50 * 2) ?少し #\@上達した（＋{LOCAL:2}）
	CALL SENGIUP, TARGET, 3
ELSE
	IF CFLAG:111 > 0
		CALL REST
		GOTO END_TRAINING
	ENDIF
	PRINTL 正しい値を入力してください
	GOTO INPUT_LOOP
ENDIF

;経験値の取得
LOCAL = 10 + RAND(5)
CALL GET_EXP, LOCAL

CALL GET_SYUREN, LOCAL:3
;部位結界の上限設定
CALL BASEUP_CAL_SHIELD, TARGET

;実績
CALL GET_STATE_TROPHY,TARGET
PRINTL 

;口上呼び出し：鍛練終了
CALL MESSAGE_TRAINING_END

PRINTW 

$END_TRAINING
BEGIN TURNEND

;--------------------------------------------------
;昼の場合、鍛錬に打ち込む度合いを決められる　（←　β２から決められなくした）
@TRAINING_DAYTIME, ARG:0, ARG:1, ARG:2, ARG:3, ARG:4
IF TIME == 0
	;PRINTFORML [0]全力で取り組む 体力 -{ARG:4 * 200 / 80}
	;PRINTFORML [1]普通に取り組む 体力 -{ARG:4}
	;$INPUT_LOOP_DOAI
	;INPUT
	;IF RESULT == 0
	;	ARG:0 = 20 * FLAG:50
	;	ARG:1 = 2 * FLAG:50
	;	ARG:2 = 6 * FLAG:50
	;	ARG:3 = 4 * FLAG:50
	;	ARG:4 = ARG:4 * 200 / 80
	;ELSEIF RESULT == 1
	;ELSE
		;GOTO INPUT_LOOP_DOAI
	;ENDIF
ENDIF
RETURN ARG:0, ARG:1, ARG:2, ARG:3, ARG:4

;---------------------------------------------------------
;トレーニングの消費体力計算
@TRAINING_DOWNTAIRYOKU, ARG
LOCAL = MAXBASE:ARG:体力
TIMES LOCAL, 0.10
IF FLAG:50 == 1
	TIMES LOCAL, 2.00
ELSEIF FLAG:50 == 2
	TIMES LOCAL, 1.80
ELSEIF FLAG:50 == 3
	TIMES LOCAL, 1.50
ELSEIF FLAG:50 == 4
	TIMES LOCAL, 1.25
ELSEIF FLAG:50 >= 5
	TIMES LOCAL, 1.00
ENDIF
LOCAL = SYOUHI_KEIGEN(TARGET,LOCAL,体力)
RETURN LOCAL
