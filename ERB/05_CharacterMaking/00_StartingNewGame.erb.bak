@START_CHARA_MAKE
#DIM MENBERS
#DIM CCOUNT

$MASTER_LOOP_CHARAMAKE
FIRSTLINE = LINECOUNT
IF FLAG:0 == 2
	MENBERS = 1
ELSE
	MENBERS = 3
	IF (GLOBAL:100 + GLOBAL:101 + GLOBAL:102) > 0
		PRINTL 
		PRINTFORML 周回クリアボーナス：
		PRINTFORML ゲーム開始時の人数を増減できます
		PRINTFORML [-1] １人減らす　　　　　　　　　　（2人で開始）
		PRINTFORML [ 0] デフォルト　　　　　　　　　　（3人で開始）
		PRINTFORML [ 1] １人増やす　　　　　　　　　　（4人で開始）
		PRINTFORML [ 2] ２人増やす　　　　　　　　　　（5人で開始）
		PRINTFORML [ 3] ３人増やす　　　　　　　　　　（6人で開始）
		PRINTFORML [10]初期セットから選ぶ
		PRINTL 
		PRINTFORML [99]ゲームモード選択に戻る
		$INPUT_LOOP_CHARA_NUM
		INPUT
		IF RESULT >= -1 && RESULT <= 3
			MENBERS = RESULT + 3
			PRINTFORML {LOCAL}人で開始します
		ELSEIF RESULT == 10
			GOTO SELECTED_SHOKISET
		ELSEIF RESULT == 99
			CLEARLINE LINECOUNT - FIRSTLINE
			RETURN 99
		ELSE
			GOTO INPUT_LOOP_CHARA_NUM
		ENDIF
	ELSE

	ENDIF
ENDIF
;ソロモード以外でデフォルト人数でなかった場合は制限日数が変動する
IF FLAG:0 != 2
	FLAG:2 -= MENBERS - 3
	SIF FLAG:0 != 10
		FLAG:1 = (FLAG:3 * FLAG:2) + (FLAG:4 * 10)
ENDIF
PRINTL 
PRINTL キャラメイキングを行いますか？
PRINTL [0]いいえ
PRINTL [1]はい
SIF (GLOBAL:100 + GLOBAL:101 + GLOBAL:102) == 0 && FLAG:0 != 2
	PRINTL [2]初期セットから選ぶ
PRINTL 
PRINTL [99]ゲームモード選択に戻る
RESETCOLOR
$INPUT_LOOP_CHARA_MAKE
INPUT
IF RESULT == 0
	REPEAT LOCAL
		ADDCHARA 0
		FLAG:8 ++
	REND
	PRINTL デフォルト設定で遊びます
	;相性データのコンバート
	CALL CONVERT_RELATION
ELSEIF RESULT == 1
	REPEAT LOCAL
		ADDCHARA 0
		FLAG:8 ++
	REND
	PRINTL キャラメイキングを行います
	PRINTL 
	CALL CHARA_MAKE_MAIN, 0
ELSEIF RESULT == 2 && (GLOBAL:100 + GLOBAL:101 + GLOBAL:102) == 0 && FLAG:0 != 2
	$SELECTED_SHOKISET
	TRYCALL CHARA_MAKE_DEFAULT_KAI
	IF RESULT < 0
		CLEARLINE LINECOUNT - LCOUNT_CHARAMAKE
		GOTO MASTER_LOOP_CHARAMAKE
	ENDIF
ELSEIF RESULT == 99
	CLEARLINE LINECOUNT - LCOUNT_MODE_SELECT
	RETURN 99
ELSE
	GOTO INPUT_LOOP_CHARA_MAKE
ENDIF
PRINTL 

;**********************************************************
;キャラクターデフォルト設定
CALL CHARA_MAKE_DEFAULT

;**********************************************************
;全キャラ共通処理

;専用口上の番号を設定
FOR CCOUNT, 0, CHARANUM
	SIF CCOUNT == MASTER
		CONTINUE
	CFLAG:CCOUNT:6 = NO:CCOUNT
	SIF NO:CCOUNT == 0 && TALENT:CCOUNT:オトコ > 0
		CFLAG:CCOUNT:6 = 1
	SIF NO:CCOUNT == 0 && TALENT:CCOUNT:ロボっ子 > 0
		CFLAG:CCOUNT:6 = 2
	IF TALENT:CCOUNT:口上設定 == -2
		CFLAG:CCOUNT:6 = -2
	ELSEIF TALENT:CCOUNT:口上設定 == 0 && TALENT:CCOUNT:オトコ > 0
		CFLAG:CCOUNT:6 = 1
	ELSEIF TALENT:CCOUNT:口上設定 == 0
		CFLAG:CCOUNT:6 = 0
	ELSEIF TALENT:CCOUNT:口上設定 == 1
		CFLAG:CCOUNT:6 = 2
	ELSEIF TALENT:CCOUNT:口上設定 == 2
		CFLAG:CCOUNT:6 = 3
	ENDIF
NEXT
