
; Starts new game
;-------------------
@EVENTFIRST
#DIM CCOUNT
#DIMS SELECTS


REDRAW 0 ;
CLEARLINE LINECOUNT ;Clear page
FIRSTLINE = LINECOUNT
$MASTER_LOOP

;ゲームモード再選択に備えてフラグをリセット
FLAG:100 = 0
FLAG:101 = 0
FLAG:852 = 5000
FLAG:906 = 0


CALL MODE_SELECT
SIF RESULT == 101
BEGIN TITLE

CALL NEWGAME_INSTALL

CALL START_CHARA_MAKE
SIF RESULT == 99
GOTO MASTER_LOOP

;プロローグ
CALL COLORLINE(1,"-")
CALL ADD_LINE(2)
CALL STARPRINT("プロローグを表示しますか？ ★",,1,2)
PRINTL
CALL INPUTYN(1,2,,2)
CALL ADD_MAXLINE(34)
$INPUT_LOOP_PRO
INPUT
SELECTCASE RESULT
    CASE 1
    TEMP = 1
    ;ストーリー実装するとモードごとに違うプロローグがあります
    ;CALLFORM PROLOUGE_{MODENUM}
    CALL PROLOUGE_01
    CASE 2
    PRINTL
    CASEELSE
	GOTO INPUT_LOOP_PRO
ENDSELECT


;口上の初期設定を呼び出しなど
FOR LOCAL,0,CHARANUM
	SIF LOCAL == MASTER
		CONTINUE

	TARGET = LOCAL

	SIF CFLAG:0 != 0 && CFLAG:20 == 0 && CFLAG:21 == 0
		CFLAG:21 = RAND:7 + 1

	CALL MESSAGE_FIRST

	SIF LOCAL <= パーティ人数最大値
		CFLAG:999 = 1
NEXT

;初期セットキャラ、CSVキャラ用の衣装獲得処理
FOR LOCAL, 0, CHARANUM -1
	SIF ITEM:(CFLAG:(LOCAL+1):40) == 0
		ITEM:(CFLAG:(LOCAL+1):40) = 1
	SIF ITEM:(CFLAG:(LOCAL+1):41) == 0
		ITEM:(CFLAG:(LOCAL+1):41) = 1
	SIF ITEM:(CFLAG:(LOCAL+1):42) == 0
		ITEM:(CFLAG:(LOCAL+1):42) = 1
NEXT

;防衛力減衰回避
FLAG:41 = 1
;探索ノルマを設定
CALL RESEARCH_QUOTA

CALL UPDATE
BEGIN SHOP
