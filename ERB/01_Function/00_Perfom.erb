;-------------------------------------------------
;オープニングや、エンディングなどで縦ロール演出
;-------------------------------------------------
@ROLLPRINT,MAXRLINE,WORDS
#DIM USEDLINE
#DIM MAXRLINE
#DIM CLEARL
#DIMS WORDS
;初期化
LOCALS =
USEDLINE = 0
LOCAL = 0

;入力内容を一時保存
LOCALS = %WORDS%

IF RSWITCH == 0
;ロール開始前の内容保存
	FOR LOCAL, 0, MAXRLINE
		SIF STRLENS(RLOG:LOCAL) > 0
		USEDLINE = LOCAL+1

		IF STRLENS(RLOG:LOCAL) <= 0
			RLOG:LOCAL = %LOCALS%
			USEDLINE = LOCAL+1
			SIF LOCAL == (MAXRLINE-1) && STRLENS(RLOG:LOCAL) > 0
			RSWITCH = 1
			BREAK
		ELSE
			CONTINUE
		ENDIF
	NEXT

ELSE
;ロール開始後の内容保存
   FOR LOCAL, 0, (MAXRLINE-1)
       RLOG:LOCAL = %RLOG:(LOCAL+1)%
   NEXT
   RLOG:(MAXRLINE-1) = %LOCALS%
   USEDLINE = MAXRLINE
ENDIF

;表示クリア
CLEARLINE  (LINECOUNT - FIRSTLINE) 
ALIGNMENT CENTER
CALL ADD_LINE(5)
	IF RSWITCH == 1
	;決めた行数に達成した場合
		FOR LOCAL, 0, MAXRLINE-1
  		PRINTFORML %RLOG:LOCAL%
		NEXT
  		PRINTFORML %RLOG:(MAXRLINE-1)%
	ELSEIF RSWITCH == 0 && USEDLINE > 0
	;そうじゃなく最初でもない場合
	    CALL ADD_LINE(10-USEDLINE)
    	FOR LOCAL, 0, (USEDLINE-1)
	    PRINTFORML %RLOG:LOCAL%
		NEXT
	    PRINTFORML %RLOG:(USEDLINE-1)%
	ELSE
	;はじめ
	CALL ADD_LINE(9)
    PRINTFORM %LOCALS%
	ENDIF
CALL ADD_MAXLINE(34)
ALIGNMENT LEFT

TWAIT 1000,0
;1000MSで自動ロール演出、クリックで早めに進める、右クリックでスキップ。

@RESETROLL
VARSET RLOG
VARSET RCOUNT
VARSET RSWITCH