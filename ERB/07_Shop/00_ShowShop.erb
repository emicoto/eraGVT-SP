@SHOW_SHOP
#DIM CCOUNT
;人気度の上限下限を設定
FLAG:853 = LIMIT(FLAG:853, -100, 100)
DRAWLINE
;フラッシュニュース
CALL FLASHNEWS

;途中ロード用
FLAG:799 = 0

;生き残っているボスの数を見る
CALL TENTACLE_SURVIVE, "NUM"
LOCAL = RESULT

IF TIME == 0
	LOCALS = 昼
ELSEIF TIME == 1
	LOCALS = 夜
ENDIF

;**********************************************************
;ここからショップ画面表示部分

DRAWLINE
PRINTFORM インターミッション {DAY}日目 
IF TIME == 0
	SETCOLOR 230,100,0
ELSE
	SETCOLOR 0,30,230
ENDIF
PRINTFORM %LOCALS%
RESETCOLOR
;日数制限解除の効果
IF FLAG:906 > 0
	IF FLAG:0 == 0
		PRINTL 
	ELSE
		PRINTFORML （完全殲滅まで∞日）
	ENDIF
ELSEIF FLAG:10 == 0
	IF FLAG:0 == 0
		PRINTL 
	ELSEIF FLAG:0 == 10
		PRINTFORML （{FLAG:3 - LOCAL + 1}体目殲滅まで{(FLAG:3 - LOCAL + 1) * FLAG:2 - DAY + DAY:1}日/完全殲滅まで∞日）
	ELSE
		PRINTFORML （{FLAG:3 - LOCAL + 1}体目殲滅まで{(FLAG:3 - LOCAL + 1) * FLAG:2 - DAY + DAY:1}日/完全殲滅まで{FLAG:1 - DAY + DAY:1}日）
	ENDIF
ELSEIF FLAG:10 == 1
	IF FLAG:0 == 0
		PRINTL 
	ELSEIF FLAG:0 == 10
		PRINTFORML （完全殲滅まで∞日）
	ELSE
		PRINTFORML （完全殲滅まで{FLAG:1 - DAY + DAY:1}日）
	ENDIF
ENDIF
;資金
PRINTFORM 資金：{MONEY}＄　
;防衛力
IF FLAG:852 == 0
	SETCOLOR 120,0,0
ELSEIF FLAG:852 < 1250
	SETCOLOR 250,0,0
ELSEIF FLAG:852 < 2500
	SETCOLOR 250,250,100
ELSEIF FLAG:852 < 10000
	SETCOLOR 0,250,60
ELSEIF FLAG:852 < 20000
	SETCOLOR 0,200,255
ELSE
	SETCOLOR 200,0,255
ENDIF
PRINTFORM 防衛力：{FLAG:852}　　
;人気度
IF FLAG:853 <= -75
	SETCOLOR 180,0,0
ELSEIF FLAG:853 <= -50
	SETCOLOR 250,50,50
ELSEIF FLAG:853 < 0
	SETCOLOR 250,200,200
ELSEIF FLAG:853 < 50
	SETCOLOR 200,250,200
ELSEIF FLAG:853 < 75
	SETCOLOR 100,250,150
ELSE
	SETCOLOR 100,250,200
ENDIF
PRINTFORM 人気度：{FLAG:853}
PRINTL 
;探索状況
IF FLAG:47 >= FLAG:46
	SETCOLOR 255,125,125
ELSE
	SETCOLOR 255,180,0
ENDIF
PRINTFORM 探索状況：
IF FLAG:47 < FLAG:46
	PRINTFORM 探索度{PERCENT_CAL_F(FLAG:47, FLAG:46)}％ ({FLAG:47}/{FLAG:46})
ELSEIF FLAG:10 == 1
	PRINTFORM ラスボス触手を発見！
ELSE
	PRINTFORM ボス触手を発見！
ENDIF
IF FLAG:47 >= FLAG:46
	IF TIME == 0
		LOCAL:1 = 40
	ELSEIF TIME == 1
		LOCAL:1 = 50
	ENDIF
	IF FLAG:10 == 1
		LOCAL:1 += 50
	ELSE
		LOCAL:1 += FLAG:3 * 3
	ENDIF
	LOCAL:1 = LOCAL:1 * FLAG:47 / FLAG:46
	FOR LOCAL,0, CHARANUM
		SIF CONFIG_CHECK_BALANCE_F(1) > 0 && FLAG:18 > 0 && (CFLAG:LOCAL:100 == 101 || CFLAG:LOCAL:100 == 105)
			LOCAL:1 += 4
	NEXT
	SIF LOCAL:1 > 95
		LOCAL:1 = 95
	PRINTFORM (遭遇率 {LOCAL:1}％)　
	SETCOLOR 255,255,225
	IF CONFIG_CHECK_BALANCE_F(1) > 0 && FLAG:18 > 0
		PRINT 索敵対象：
		FLAG:11 = FLAG:18
		SAVESTR:13 = BOSS
		CALL TENTACLE_ACCESS, "GETNAME"
		PRINTFORM %RESULTS%
	ENDIF
ENDIF
RESETCOLOR
PRINTL 
;キャラのステータス
CALL SHOW_STATUS_BASE
PRINTPLAIN                                      
SIF CHARANUM_ALIVE_PARTYCHECK(0) == 0
	PRINTPLAIN                     
IF CHARANUM > 2 || CHARANUM_ALIVE_PARTYCHECK(0) || FLAG:63
	IF FLAG:63
		FONTBOLD
		SETCOLOR 250,180,50
	ENDIF
	PRINT [50] パーティ編成　
	SIF FLAG:63 == 0
		PRINTPLAIN  
	FONTREGULAR
	RESETCOLOR
ELSE
	PRINTPLAIN                
ENDIF
IF CHARANUM_ALIVE_PARTYCHECK(0) && FLAG:61
	PRINT     [60] ▲操作キャラのみ
ELSEIF CHARANUM_ALIVE_PARTYCHECK(0)
	PRINT         [60] ▼全表示
ENDIF
PRINTL 

;インフォメーション
PRINTL 【インフォメーション】
CALL SHOP_INFOMATION
PRINTL 

;各キャラの行動予定の表示
SIF FLAG:63 == 0
	CALL SHOP_ACTION_PLANDISP(0)

;一括設定用
IF FLAG:9 == 1
	LOCAL:1 = 1
	FONTBOLD
	SETCOLOR 255, 150, 0
ELSE
	SETCOLOR 120, 60, 0
ENDIF
SIF CHARANUM_ALIVE() >= 2 && FLAG:63 == 0
	PRINTFORM [90]一括設定
RESETCOLOR
FONTREGULAR
SIF FLAG:63 == 0
	PRINTL 
DRAWLINE
;地の文：ショップ画面での一口メッセージ呼び出し用
LOCAL = TARGET
LOCAL:1 = 0
IF FLAG:9 && CHARANUM_ACTIVE() > 0
	$HITOKUCHI_LOOP
	TARGET = RAND:(CHARANUM -1) + 1
	SIF CFLAG:TARGET:0 != 0 || CFLAG:TARGET:999 == 0
		GOTO HITOKUCHI_LOOP
ENDIF
SIF CFLAG:TARGET:0 == 0 && FLAG:63 == 0 && TARGET != MASTER
	CALL MESSAGE_HITOKUTI_SHOP
TARGET = LOCAL

IF FLAG:63 == 0
	PRINTL [100]行動開始
	PRINTL 
ELSE
	IF TARGET != 0
		PRINT 選択中のキャラ：
		SETCOLOR 250,180,50
		PRINTPLAINFORM [{TARGET}]%CALLNAME:TARGET%
		RESETCOLOR
		PRINTL 　⇒　
		PRINTL （位置を入れ替える対象のキャラを選択してください）
		PRINTL （選択中のキャラを再度選ぶと選択を解除します）
	ELSE
		PRINTFORML 選択中のキャラ：なし
		PRINTL （配置を変更するキャラを選択してください）
		PRINTL 
	ENDIF
	IF TARGET != 0
		IF CFLAG:TARGET:999 == 0 && CHARANUM_ACTIVE() < パーティ人数最大値
			PRINTL 
			IF CFLAG:TARGET:0 == 10
				PRINT 選択中のキャラは特別病棟に入院中のため、パーティに加えられません。
			ELSEIF CFLAG:TARGET:0 == 11
				PRINT 選択中のキャラは特別病棟に育児中のため、パーティに加えられません。
			ELSE
				PRINTL [100]選択中のキャラをパーティに加える
			ENDIF
		ELSEIF CFLAG:TARGET:999
			PRINTL 
			PRINTL [100]選択中のキャラをパーティから外す
		ENDIF
	ENDIF
ENDIF
IF FLAG:0 != 0 && FLAG:63 == 0
	SETCOLOR 255, 170, 170
	PRINTFORM [101]出撃する　　　 
	SETCOLOR 255, 255, 170
	PRINTFORM [102]鍛錬する　　　 
	SETCOLOR 170, 170, 255
	PRINTFORM [103]休憩する　　　 
	SETCOLOR 170, 255, 255
	PRINTFORM [104]特別活動　　　 
	PRINTL 

	IF FLAG:0 != 2
		SETCOLOR 255, 170, 255
		PRINTFORM [105]拠点防衛　　　 
	ELSE
		SETCOLOR 96,96,96
		PRINTPLAIN [105]拠点防衛　　　 
	ENDIF
	IF CHARANUM >= 3
		SETCOLOR 170, 255, 170
		PRINTFORM [106]戦闘支援　　　 
	ELSE
		SETCOLOR 96,96,96
		PRINTPLAIN [106]戦闘支援　　　 
	ENDIF
	SETCOLOR 255, 200, 50
	PRINTFORM [107]情報収集　　　 
	SETCOLOR 50, 200, 255
	PRINTFORM [108]自由行動
	PRINTL 
ENDIF
RESETCOLOR
PRINTL 
PRINT [110]ステータス表示 
IF FLAG:0 != 0 && FLAG:63 == 0
	PRINT [111]キャラの強化   
	PRINT [112]衣装の設定　　 
	PRINTL [113]メディカルルーム
	PRINTL [114]カスタマイズ 
	PRINT [120]衣装の購入　　 
ELSE
	PRINTL 
ENDIF
PRINT [130]状況の確認　　 
;SIF GETBIT(FLAG:###,11) && CHARANUM > 4
;	PRINT [140]引退する　　　 
IF FLAG:63 == 0 && FLAG:0 != 0
	PRINT [150]施設の拡張　　 
	PRINT [160]スケジュール設定
ENDIF
PRINTL 
PRINT [200]セーブ　　　　 
PRINT [300]ロード         
PRINT [700]コンフィグ　　 
PRINT [800]トロフィー確認 
