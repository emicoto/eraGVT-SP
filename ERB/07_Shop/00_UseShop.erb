@USERSHOP
#DIM CCOUNT
IF RESULT == 100 && TARGET != 0 && FLAG:63 && CFLAG:TARGET:0 == 0
	IF CFLAG:TARGET:999 == 0 && CHARANUM_ACTIVE() < パーティ人数最大値
		CFLAG:TARGET:999 = 1
	ELSEIF CFLAG:TARGET:999
		CFLAG:TARGET:999 = 0
		SIF CHARANUM_ALIVE_PARTYCHECK(0)
			FLAG:61 = 1
	ENDIF
	TARGET = 0
ELSEIF RESULT == 100 && FLAG:63 == 0
	CALL SORTIE_CHECK
	IF FLAG:40 == 0 && FLAG:0 != 0
		DRAWLINE
		PRINTL 
		PRINTL 各キャラの行動予定は下のようです
		PRINTL 
		CALL SHOP_ACTION_PLANDISP(1)
		PRINTL 
		PRINTL この設定で行動を開始しますか？
		PRINTL ※ 行動を設定していないキャラは自動的に休憩になります
		CALL SORTIE_CHECK
		SIF RESULT == 0 && FLAG:0 != 2
			PRINTL ※ 出撃または防衛しないことにより防衛力が低下します
		DRAWLINE
		PRINTL [0]いいえ
		PRINTL [1]はい
		PRINTL [9]はい（次から確認しない）
		$INPUT_LOOP
		INPUT
		IF RESULT == 9
			FLAG:40 = 1
			CALL SHOP_ACTION
		ELSEIF RESULT < 0 || RESULT > 9
		ELSEIF RESULT == 0
		ELSEIF RESULT == 1
			CALL SHOP_ACTION
		ENDIF
	;出撃もしくは防衛できるキャラがいない
	ELSEIF FLAG:40 == 1 && RESULT == 0 && FLAG:0 != 2 && FLAG:0 != 0
		DRAWLINE
		PRINTL 
		PRINTL 出撃・防衛を行う予定のキャラが一人も居ません
		PRINTL 
		CALL SHOP_ACTION_PLANDISP(1)
		PRINTL 
		PRINTL このまま行動を開始して宜しいですか？
		PRINTL ※ 出撃または防衛しないことにより防衛力が低下します
		DRAWLINE
		PRINTL [0]いいえ
		PRINTL [1]はい
		PRINTL [9]はい（次から確認しない）
		$INPUT_LOOP_1
		INPUT
		IF RESULT == 9
			FLAG:40 = 2
			CALL SHOP_ACTION
		ELSEIF RESULT < 0 || RESULT > 9
		ELSEIF RESULT == 0
		ELSEIF RESULT == 1
			CALL SHOP_ACTION
		ENDIF
	ELSE
		CALL SHOP_ACTION
	ENDIF
ELSEIF RESULT == 101 && FLAG:0 != 0 && TARGET != MASTER && (CFLAG:0 == 0 || FLAG:9) && FLAG:63 == 0
	IF FLAG:9 == 0
		PRINTL 
		;妊娠中は出撃できない
		IF CHECK_PREGNANT_F(TARGET)
			PRINTL 妊娠中は出撃できません
			PRINTL
		;FEAT効果によるコマンド制限
		ELSEIF TALENT:夜魔の貴族 > 0 && TIME == 0
			SETCOLOR 255,128,0
			PRINTFORML %CALLNAME%は[夜魔の貴族]の効果で昼間は外出できません！
			RESETCOLOR
			PRINTL 
		ELSE
			CFLAG:100 = 101
			PRINTFORML %CALLNAME%は出撃することにしました
		ENDIF
	ELSE
		FOR CCOUNT, 0, CHARANUM
			SIF CCOUNT == MASTER
				CONTINUE
			SIF CFLAG:CCOUNT:999 == 0
				CONTINUE
			SIF CFLAG:CCOUNT:0 == 1 || CFLAG:CCOUNT:0 == 2 || CFLAG:CCOUNT:0 == 3 || CFLAG:CCOUNT:0 == 9
				CONTINUE
			PRINTL 
			;妊娠中は出撃できない
			IF CHECK_PREGNANT_F(CCOUNT) > 0
				PRINTFORML %CALLNAME:CCOUNT%は妊娠中のため出撃できません
			;FEAT効果によるコマンド制限
			ELSEIF TALENT:CCOUNT:夜魔の貴族 > 0 && TIME == 0
				SETCOLOR 255,128,0
				PRINTFORML %CALLNAME:CCOUNT%は[夜魔の貴族]の効果で外出は出撃できません！
				RESETCOLOR
			ELSE
				CFLAG:CCOUNT:100 = 101
				PRINTFORML %CALLNAME:CCOUNT%は出撃することにしました
			ENDIF
		NEXT
	ENDIF
	PRINTW 
ELSEIF RESULT == 102 && FLAG:0 != 0 && TARGET != MASTER && (CFLAG:0 == 0 || FLAG:9) && FLAG:63 == 0
	IF FLAG:9 == 0
		PRINTL 
		CFLAG:100 = 102
		PRINTFORML %CALLNAME%は鍛錬をすることにしました
	ELSE
		FOR CCOUNT, 0, CHARANUM
			SIF CCOUNT == MASTER
				CONTINUE
			SIF CFLAG:CCOUNT:999 == 0
				CONTINUE
			SIF CFLAG:CCOUNT:0 == 1 || CFLAG:CCOUNT:0 == 2 || CFLAG:CCOUNT:0 == 3 || CFLAG:CCOUNT:0 == 9
				CONTINUE
			PRINTL 
			CFLAG:CCOUNT:100 = 102
			PRINTFORML %CALLNAME:CCOUNT%は鍛錬をすることにしました
		NEXT
	ENDIF
	PRINTW 
ELSEIF RESULT == 103 && FLAG:0 != 0 && TARGET != MASTER && (CFLAG:0 == 0 || FLAG:9) && FLAG:63 == 0
	IF FLAG:9 == 0
		PRINTL 
		CFLAG:100 = 103
		PRINTFORML %CALLNAME%は休憩することにしました
	ELSE
		FOR CCOUNT, 0, CHARANUM
			SIF CCOUNT == MASTER
				CONTINUE
			SIF CFLAG:CCOUNT:999 == 0
				CONTINUE
			SIF CFLAG:CCOUNT:0 == 1 || CFLAG:CCOUNT:0 == 2 || CFLAG:CCOUNT:0 == 3 || CFLAG:CCOUNT:0 == 9
				CONTINUE
			PRINTL 
			CFLAG:CCOUNT:100 = 103
			PRINTFORML %CALLNAME:CCOUNT%は休憩することにしました
		NEXT
	ENDIF
	PRINTW 
ELSEIF RESULT == 104 && FLAG:0 != 0 && TARGET != MASTER && (CFLAG:0 == 0 || FLAG:9) && FLAG:63 == 0
	IF FLAG:9 == 0
		;FEAT効果によるコマンド制限
		IF TALENT:夜魔の貴族 > 0 && TIME == 0
			SETCOLOR 255,128,0
			PRINTFORML %CALLNAME%は[夜魔の貴族]の効果で昼間は外出できません！
			RESETCOLOR
			PRINTL 
		ELSEIF TALENT:生粋の戦士 > 0
			SETCOLOR 255,128,0
			PRINTFORML %CALLNAME%は[生粋の戦士]の効果で特別活動に参加できません！
			RESETCOLOR
			PRINTL 
		ELSE
			PRINTL 
			CFLAG:100 = 104
			PRINTFORML %CALLNAME%は資金を稼ぐことにしました
		ENDIF
	ELSE
		FOR CCOUNT, 0, CHARANUM
			SIF CCOUNT == MASTER
				CONTINUE
			SIF CFLAG:CCOUNT:999 == 0
				CONTINUE
			SIF CFLAG:CCOUNT:0 == 1 || CFLAG:CCOUNT:0 == 2 || CFLAG:CCOUNT:0 == 3 || CFLAG:CCOUNT:0 == 9
				CONTINUE
			PRINTL 
			;FEAT効果によるコマンド制限
			IF TALENT:CCOUNT:夜魔の貴族 > 0 && TIME == 0
				SETCOLOR 255,128,0
				PRINTFORML %CALLNAME:CCOUNT%は[夜魔の貴族]の効果で昼間は外出できません！
				RESETCOLOR
			ELSEIF TALENT:CCOUNT:生粋の戦士 > 0
				SETCOLOR 255,128,0
				PRINTFORML %CALLNAME:CCOUNT%は[生粋の戦士]の効果で特別活動に参加できません！
				RESETCOLOR
			ELSE
				CFLAG:CCOUNT:100 = 104
				PRINTFORML %CALLNAME:CCOUNT%は資金を稼ぐことにしました
			ENDIF
		NEXT
	ENDIF
	PRINTW 
ELSEIF RESULT == 105 && FLAG:0 != 2 && FLAG:0 != 0 && TARGET != MASTER && (CFLAG:0 == 0 || FLAG:9) && FLAG:63 == 0
	IF FLAG:9 == 0
		PRINTL 
		;妊娠中は出撃できない
		IF CHECK_PREGNANT_F(TARGET) > 0
			PRINTL 妊娠中は防衛に参加できません
			PRINTL
		;FEAT効果によるコマンド制限
		ELSEIF TALENT:夜魔の貴族 > 0 && TIME == 0
			SETCOLOR 255,128,0
			PRINTFORML %CALLNAME%は[夜魔の貴族]の効果で昼間は外出できません！
			RESETCOLOR
			PRINTL 
		ELSE
			PRINTFORML %CALLNAME%は拠点を防衛することにしました
			CFLAG:100 = 105
		ENDIF
	ELSE
		FOR CCOUNT, 0, CHARANUM
			SIF CCOUNT == MASTER
				CONTINUE
			SIF CFLAG:CCOUNT:999 == 0
				CONTINUE
			SIF CFLAG:CCOUNT:0 == 1 || CFLAG:CCOUNT:0 == 2 || CFLAG:CCOUNT:0 == 3 || CFLAG:CCOUNT:0 == 9
				CONTINUE
			PRINTL 
			;妊娠中は出撃できない
			IF CHECK_PREGNANT_F(CCOUNT) > 0
				PRINTFORML %CALLNAME:CCOUNT%は妊娠中のため防衛に参加できません
			;FEAT効果によるコマンド制限
			ELSEIF TALENT:CCOUNT:夜魔の貴族 > 0 && TIME == 0
				SETCOLOR 255,128,0
				PRINTFORML %CALLNAME:CCOUNT%は[夜魔の貴族]の効果で昼間は外出できません！
				RESETCOLOR
			ELSE
				CFLAG:CCOUNT:100 = 105
				PRINTFORML %CALLNAME:CCOUNT%は拠点を防衛することにしました
			ENDIF
		NEXT
	ENDIF
	PRINTW 
ELSEIF RESULT == 106 && CHARANUM >= 3 && FLAG:0 != 0 && TARGET != MASTER && (CFLAG:0 == 0 || FLAG:9) && FLAG:63 == 0
	IF FLAG:9 == 0
		IF TALENT:生粋の戦士 > 0
			SETCOLOR 255,128,0
			PRINTFORML %CALLNAME%は[生粋の戦士]の効果で戦闘支援に参加できません！
			RESETCOLOR
			PRINTL 
		ELSE
			PRINTL 
			CFLAG:100 = 106
			PRINTFORML %CALLNAME%は後方で戦闘支援に徹します
		ENDIF
	ELSE
		FOR CCOUNT, 0, CHARANUM
			SIF CCOUNT == MASTER
				CONTINUE
			SIF CFLAG:CCOUNT:999 == 0
				CONTINUE
			SIF CFLAG:CCOUNT:0 == 1 || CFLAG:CCOUNT:0 == 2 || CFLAG:CCOUNT:0 == 3 || CFLAG:CCOUNT:0 == 9
				CONTINUE
			PRINTL 
			IF TALENT:CCOUNT:生粋の戦士 > 0
				SETCOLOR 255,128,0
				PRINTFORML %CALLNAME:CCOUNT%は[生粋の戦士]の効果で戦闘支援に参加できません！
				RESETCOLOR
			ELSE
				CFLAG:CCOUNT:100 = 106
				PRINTFORML %CALLNAME:CCOUNT%は後方で戦闘支援に徹します
			ENDIF
		NEXT
	ENDIF
	PRINTW 
ELSEIF RESULT == 107 && FLAG:0 != 0 && TARGET != MASTER && (CFLAG:0 == 0 || FLAG:9) && FLAG:63 == 0
	IF FLAG:9 == 0
		;FEAT効果によるコマンド制限
		IF TALENT:夜魔の貴族 > 0 && TIME == 0
			SETCOLOR 255,128,0
			PRINTFORML %CALLNAME%は[夜魔の貴族]の効果で昼間は外出できません！
			RESETCOLOR
			PRINTL 
		ELSE
			PRINTL 
			CFLAG:100 = 107
			PRINTFORML %CALLNAME%は後方で情報収集に徹します
		ENDIF
	ELSE
		FOR CCOUNT, 0, CHARANUM
			SIF CCOUNT == MASTER
				CONTINUE
			SIF CFLAG:CCOUNT:999 == 0
				CONTINUE
			SIF CFLAG:CCOUNT:0 == 1 || CFLAG:CCOUNT:0 == 2 || CFLAG:CCOUNT:0 == 3 || CFLAG:CCOUNT:0 == 9
				CONTINUE
			PRINTL 
			;FEAT効果によるコマンド制限
			IF TALENT:CCOUNT:夜魔の貴族 > 0 && TIME == 0
				SETCOLOR 255,128,0
				PRINTFORML %CALLNAME:CCOUNT%は[夜魔の貴族]の効果で昼間は外出できません！
				RESETCOLOR
			ELSE
				CFLAG:CCOUNT:100 = 107
				PRINTFORML %CALLNAME:CCOUNT%は後方で情報収集に徹します
			ENDIF
		NEXT
	ENDIF
	PRINTW 
ELSEIF RESULT == 108 && FLAG:0 != 0 && TARGET != MASTER && (CFLAG:0 == 0 || FLAG:9) && FLAG:63 == 0
	IF FLAG:9 == 0
		;FEAT効果によるコマンド制限
		IF TALENT:夜魔の貴族 > 0 && TIME == 0
			SETCOLOR 255,128,0
			PRINTFORML %CALLNAME%は[夜魔の貴族]の効果で昼間は外出できません！
			RESETCOLOR
			PRINTL 
		ELSE
			PRINTL 
			CFLAG:100 = 108
			PRINTFORML %CALLNAME%は自由に行動することにしました
		ENDIF
	ELSE
		FOR CCOUNT, 0, CHARANUM
			SIF CCOUNT == MASTER
				CONTINUE
			SIF CFLAG:CCOUNT:999 == 0
				CONTINUE
			SIF CFLAG:CCOUNT:0 == 1 || CFLAG:CCOUNT:0 == 2 || CFLAG:CCOUNT:0 == 3 || CFLAG:CCOUNT:0 == 9
				CONTINUE
			PRINTL 
			;FEAT効果によるコマンド制限
			IF TALENT:CCOUNT:夜魔の貴族 > 0 && TIME == 0
				SETCOLOR 255,128,0
				PRINTFORML %CALLNAME:CCOUNT%は[夜魔の貴族]の効果で昼間は外出できません！
				RESETCOLOR
			ELSE
				CFLAG:CCOUNT:100 = 108
				PRINTFORML %CALLNAME:CCOUNT%は自由に行動することにしました
			ENDIF
		NEXT
	ENDIF
	PRINTW 
ELSEIF RESULT == 110
	IF CHARANUM >= 3
		WHILE RESULT != 999
			PRINTL 
			PRINTL 【ステータス表示】
			CALL CHARA_LIST, 2,1
			SIF RESULT != 999
				CALL SHOW_STATUS_CHARA_SELECT, RESULT
		WEND
	ELSE
		PRINTL 
		PRINTL 【ステータス表示】
		TARGET = 1
		CALL SHOW_STATUS_CHARA_SELECT, TARGET
	ENDIF
	SIF FLAG:63
		TARGET = 0
ELSEIF RESULT == 111 && FLAG:0 != 0 && CHARANUM_ACTIVE() && FLAG:63 == 0
	IF CHARANUM >= 3
		WHILE RESULT != 999
			PRINTL 
			PRINTL 【キャラの強化】
			CALL CHARA_LIST, 1,2
			SIF RESULT != 999
				CALL CHARA_POWERUP, RESULT
		WEND
	ELSE
		PRINTL 
		PRINTL 【キャラの強化】
		TARGET = 1
		CALL CHARA_POWERUP, TARGET
	ENDIF
ELSEIF RESULT == 112 && FLAG:0 != 0 && CHARANUM_ACTIVE() && FLAG:63 == 0
	CALL CLOTH_WEAR
ELSEIF RESULT == 113 && FLAG:0 != 0 && FLAG:63 == 0 && FLAG:63 == 0
	CALL DRUG_PREPARATION
ELSEIF RESULT == 114 && FLAG:0 != 0 && FLAG:63 == 0 && FLAG:63 == 0
	IF CHARANUM >= 3
		WHILE RESULT != 999
			PRINTL 
			PRINTL 【武器カスタマイズ】
			CALL CHARA_LIST, 1,0
			SIF RESULT != 999
				CALL WEAPON_CUSTOMIZE, RESULT
		WEND
	ELSE
		PRINTL 
		PRINTL 【武器カスタマイズ】
		TARGET = 1
		CALL WEAPON_CUSTOMIZE, TARGET
	ENDIF
ELSEIF RESULT == 120 && FLAG:0 != 0 && FLAG:63 == 0 && FLAG:63 == 0
	CALL SHOW_SHOP_CLOTH
ELSEIF RESULT == 130 && FLAG:63 == 0
	CALL SHOW_STATUS_SENMETU
;ELSEIF RESULT == 140 && GETBIT(FLAG:###,11) && CHARANUM > パーティ人数最大値 && FLAG:63 == 0
;	CALL CHARA_INTAI
ELSEIF RESULT == 150 && FLAG:0 != 0 && FLAG:63 == 0
	CALL HOME_ENHANCING
ELSEIF RESULT == 160 && FLAG:63 == 0
	IF CFLAG:0 != 0 || TARGET == MASTER || FLAG:9
		PRINTW スケジュールを設定するキャラクターが選択されていません
	ELSE
		CALL SCHEDULE
	ENDIF
ELSEIF RESULT == 200
	FIRSTLINE = LINECOUNT
	CALL SAVEGAME_PAGE
ELSEIF RESULT == 300
	FIRSTLINE = LINECOUNT
	CALL LOADGAME_PAGE
ELSEIF RESULT == 400
	;名前変更やキャラソート用に空けてる
	;DEBUG
	IF FLAG:999 == 0
		PRINTL 
		PRINTL 
		PRINTL DEBUG ON
		FLAG:999 = 1
		SETBGCOLOR 0,0,40
	ELSEIF FLAG:999 == 1
		PRINTL 
		PRINTL 
		PRINTL DEBUG OFF
		FLAG:999 = 0
		RESETBGCOLOR
	ENDIF
ELSEIF RESULT == 700
	CALL CONFIG
ELSEIF RESULT == 800
	CALL SHOW_TROPHY
ELSEIF RESULT == 90 && CHARANUM_ALIVE() >= 2 && FLAG:63 == 0
	SIF TARGET == MASTER
		TARGET = RAND:(CHARANUM-1) + 1
	IF FLAG:9 == 0
		PRINTL 一括設定モードに変更しました
		FLAG:9 = 1
	ENDIF
ELSEIF RESULT == 50 && (CHARANUM > 2 || CHARANUM_ALIVE_PARTYCHECK(0) || FLAG:63)
	IF FLAG:63
		PRINTL 編成モードを解除します
		FLAG:63 = 0
		FLAG:61 = 0
	ELSE
		CALL SET_PARTYMEMBER
		PRINTL 編成モードに移行します
		FLAG:63 = 1
		SIF CHARANUM_ALIVE_PARTYCHECK(0)
			FLAG:61 = 1
		FLAG:9 = 0
		FOR CCOUNT, 0, CHARANUM
			CFLAG:CCOUNT:100 = 0
		NEXT
		CALL SET_PARTYMEMBER
		TARGET = 0
	ENDIF
ELSEIF RESULT == 60 && CHARANUM_ALIVE_PARTYCHECK(0)
	IF FLAG:61
		PRINTL キャラを全員表示します
		FLAG:61 = 0
	ELSE
		PRINTL パーティのみ表示します
		FLAG:61 = 1
	ENDIF
ELSEIF RESULT >= 1 && RESULT <= CHARANUM -1 && CFLAG:RESULT:999 != 0 && FLAG:63 == 0
	FLAG:9 = 0
	IF CHARANUM > RESULT
		IF CFLAG:RESULT:0 == 0
			TARGET = RESULT
			PRINTL 
			PRINTFORML 操作キャラを%CALLNAME%に変更しました
			PRINTL 
		ENDIF
	ENDIF
ELSEIF RESULT >= 1 && RESULT <= CHARANUM -1 && FLAG:63
	IF CFLAG:RESULT:0 == 1 || CFLAG:RESULT:0 == 2 || CFLAG:RESULT:0 == 3 || CFLAG:RESULT:0 == 4 || CFLAG:RESULT:0 == 9
	ELSEIF TARGET == 0
		TARGET = RESULT
	ELSEIF TARGET == RESULT
		TARGET = 0
	ELSEIF CFLAG:TARGET:0 == 10
		PRINTFORML %CALLNAME:TARGET%は特別病棟に入院中のため、入れ替えられません。
		PRINTW 
		TARGET = 0
	ELSEIF CFLAG:TARGET:0 == 11
		PRINTFORML %CALLNAME:TARGET%は育児中のため、入れ替えられません。
		PRINTW 
		TARGET = 0
	ELSEIF CFLAG:RESULT:0 == 10
		PRINTFORML %CALLNAME:RESULT%は特別病棟に入院中のため、入れ替えられません。
		PRINTW 
		TARGET = 0
	ELSEIF CFLAG:RESULT:0 == 11
		PRINTFORML %CALLNAME:RESULT%は育児中のため、入れ替えられません。
		PRINTW 
		TARGET = 0
	ELSE
		;キャラを入れ替える
		SETCOLOR 250,180,50
		PRINTFORM 　[{TARGET}]%CALLNAME:TARGET%
		RESETCOLOR
		PRINT と
		SETCOLOR 250,180,50
		PRINTFORM [{RESULT}]%CALLNAME:RESULT%
		RESETCOLOR
		PRINTL の配置を入れ替えた！
		PRINTW 
		;RELATION
		FOR LOCAL, 0, CHARANUM
			SIF LOCAL == MASTER
				CONTINUE
			SWAP RELATION:LOCAL:TARGET, RELATION:LOCAL:RESULT
		NEXT
		SWAP CFLAG:TARGET:999, CFLAG:RESULT:999
		SWAPCHARA TARGET,RESULT
		TARGET = 0
	ENDIF
ELSE
ENDIF
